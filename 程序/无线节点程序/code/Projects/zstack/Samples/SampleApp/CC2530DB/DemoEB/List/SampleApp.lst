###############################################################################
#                                                                             #
# IAR C/C++ Compiler V8.30.1.41636 for 8051             19/Oct/2017  13:11:54 #
# Copyright 2004-2013 IAR Systems AB.                                         #
#                                                                             #
#    Core               =  plain                                              #
#    Code model         =  banked                                             #
#    Data model         =  large                                              #
#    Calling convention =  xdata reentrant                                    #
#    Constant location  =  data_rom                                           #
#    Dptr setup         =  1,16                                               #
#                                                                             #
#    Source file        =  D:\简宝山\寿县17-09-01 25\程序\无线节点程序\code\P #
#                          rojects\zstack\Samples\SampleApp\Source\SampleApp. #
#                          c                                                  #
#    Command line       =  -f "D:\简宝山\寿县17-09-01                         #
#                          25\程序\无线节点程序\code\Projects\zstack\Samples\ #
#                          SampleApp\CC2530DB\..\..\..\Tools\CC2530DB\f8wCoor #
#                          d.cfg" (-DCPU32MHZ -DROOT=__near_func              #
#                          -DMAC_CFG_APP_PENDING_QUEUE=TRUE                   #
#                          -DMAC_CFG_TX_DATA_MAX=5 -DMAC_CFG_TX_MAX=8         #
#                          -DMAC_CFG_RX_MAX=5 -DZDO_COORDINATOR -DRTR_NWK)    #
#                          -f "D:\简宝山\寿县17-09-01                         #
#                          25\程序\无线节点程序\code\Projects\zstack\Samples\ #
#                          SampleApp\CC2530DB\..\..\..\Tools\CC2530DB\f8wConf #
#                          ig.cfg" (-DZIGBEEPRO -DSECURE=0                    #
#                          -DZG_SECURE_DYNAMIC=0 -DREFLECTOR                  #
#                          -DDEFAULT_CHANLIST=0x00000800                      #
#                          -DZDAPP_CONFIG_PAN_ID=0xFFF1                       #
#                          -DNWK_START_DELAY=100 -DEXTENDED_JOINING_RANDOM_MA #
#                          SK=0x007F -DBEACON_REQUEST_DELAY=100               #
#                          -DBEACON_REQ_DELAY_MASK=0x00FF                     #
#                          -DLINK_STATUS_JITTER_MASK=0x007F                   #
#                          -DROUTE_EXPIRY_TIME=30 -DAPSC_ACK_WAIT_DURATION_PO #
#                          LLED=3000 -DNWK_INDIRECT_MSG_TIMEOUT=7             #
#                          -DMAX_RREQ_ENTRIES=8 -DAPSC_MAX_FRAME_RETRIES=3    #
#                          -DNWK_MAX_DATA_RETRIES=2                           #
#                          -DMAX_POLL_FAILURE_RETRIES=2 -DMAX_BCAST=9         #
#                          -DAPS_MAX_GROUPS=16 -DMAX_RTG_ENTRIES=40           #
#                          -DNWK_MAX_BINDING_ENTRIES=4                        #
#                          -DMAX_BINDING_CLUSTER_IDS=4 "-DDEFAULT_KEY={0x01,  #
#                          0x03, 0x05, 0x07, 0x09, 0x0B, 0x0D, 0x0F, 0x00,    #
#                          0x02, 0x04, 0x06, 0x08, 0x0A, 0x0C, 0x0D}"         #
#                          -DMAC_MAX_FRAME_SIZE=116                           #
#                          -DZDNWKMGR_MIN_TRANSMISSIONS=20 "-DCONST=const     #
#                          __code" -DGENERIC=__generic                        #
#                          -DRFD_RCVC_ALWAYS_ON=FALSE -DPOLL_RATE=1000        #
#                          -DQUEUED_POLL_RATE=100 -DRESPONSE_POLL_RATE=100)   #
#                          -DREJOIN_POLL_RATE=440 "D:\简宝山\寿县17-09-01     #
#                          25\程序\无线节点程序\code\Projects\zstack\Samples\ #
#                          SampleApp\Source\SampleApp.c" -D                   #
#                          BUILD_ALL_DEVICES -D HOLD_AUTO_START -D            #
#                          LCD_SUPPORTED -D HAL_UART=FALSE -lC                #
#                          "D:\简宝山\寿县17-09-01 25\程序\无线节点程序\code\ #
#                          Projects\zstack\Samples\SampleApp\CC2530DB\DemoEB\ #
#                          List\" -lA "D:\简宝山\寿县17-09-01                 #
#                          25\程序\无线节点程序\code\Projects\zstack\Samples\ #
#                          SampleApp\CC2530DB\DemoEB\List\" --diag_suppress   #
#                          Pe001,Pa010 -o "D:\简宝山\寿县17-09-01             #
#                          25\程序\无线节点程序\code\Projects\zstack\Samples\ #
#                          SampleApp\CC2530DB\DemoEB\Obj\" -e                 #
#                          --no_code_motion --debug --core=plain --dptr=16,1  #
#                          --data_model=large --code_model=banked             #
#                          --calling_convention=xdata_reentrant               #
#                          --place_constants=data_rom --nr_virtual_regs 16    #
#                          -I "D:\简宝山\寿县17-09-01                         #
#                          25\程序\无线节点程序\code\Projects\zstack\Samples\ #
#                          SampleApp\CC2530DB\" -I "D:\简宝山\寿县17-09-01    #
#                          25\程序\无线节点程序\code\Projects\zstack\Samples\ #
#                          SampleApp\CC2530DB\..\Source\" -I                  #
#                          "D:\简宝山\寿县17-09-01 25\程序\无线节点程序\code\ #
#                          Projects\zstack\Samples\SampleApp\CC2530DB\..\Sour #
#                          ce\hardware\" -I "D:\简宝山\寿县17-09-01           #
#                          25\程序\无线节点程序\code\Projects\zstack\Samples\ #
#                          SampleApp\CC2530DB\..\..\..\ZMain\TI2530DB\" -I    #
#                          "D:\简宝山\寿县17-09-01 25\程序\无线节点程序\code\ #
#                          Projects\zstack\Samples\SampleApp\CC2530DB\..\..\. #
#                          .\..\..\Components\hal\include\" -I                #
#                          "D:\简宝山\寿县17-09-01 25\程序\无线节点程序\code\ #
#                          Projects\zstack\Samples\SampleApp\CC2530DB\..\..\. #
#                          .\..\..\Components\hal\target\CC2530EB\" -I        #
#                          "D:\简宝山\寿县17-09-01 25\程序\无线节点程序\code\ #
#                          Projects\zstack\Samples\SampleApp\CC2530DB\..\..\. #
#                          .\..\..\Components\mac\include\" -I                #
#                          "D:\简宝山\寿县17-09-01 25\程序\无线节点程序\code\ #
#                          Projects\zstack\Samples\SampleApp\CC2530DB\..\..\. #
#                          .\..\..\Components\mac\high_level\" -I             #
#                          "D:\简宝山\寿县17-09-01 25\程序\无线节点程序\code\ #
#                          Projects\zstack\Samples\SampleApp\CC2530DB\..\..\. #
#                          .\..\..\Components\mac\low_level\srf04\" -I        #
#                          "D:\简宝山\寿县17-09-01 25\程序\无线节点程序\code\ #
#                          Projects\zstack\Samples\SampleApp\CC2530DB\..\..\. #
#                          .\..\..\Components\mac\low_level\srf04\single_chip #
#                          \" -I "D:\简宝山\寿县17-09-01                      #
#                          25\程序\无线节点程序\code\Projects\zstack\Samples\ #
#                          SampleApp\CC2530DB\..\..\..\..\..\Components\mt\"  #
#                          -I "D:\简宝山\寿县17-09-01                         #
#                          25\程序\无线节点程序\code\Projects\zstack\Samples\ #
#                          SampleApp\CC2530DB\..\..\..\..\..\Components\osal\ #
#                          include\" -I "D:\简宝山\寿县17-09-01               #
#                          25\程序\无线节点程序\code\Projects\zstack\Samples\ #
#                          SampleApp\CC2530DB\..\..\..\..\..\Components\servi #
#                          ces\saddr\" -I "D:\简宝山\寿县17-09-01             #
#                          25\程序\无线节点程序\code\Projects\zstack\Samples\ #
#                          SampleApp\CC2530DB\..\..\..\..\..\Components\servi #
#                          ces\sdata\" -I "D:\简宝山\寿县17-09-01             #
#                          25\程序\无线节点程序\code\Projects\zstack\Samples\ #
#                          SampleApp\CC2530DB\..\..\..\..\..\Components\stack #
#                          \af\" -I "D:\简宝山\寿县17-09-01                   #
#                          25\程序\无线节点程序\code\Projects\zstack\Samples\ #
#                          SampleApp\CC2530DB\..\..\..\..\..\Components\stack #
#                          \nwk\" -I "D:\简宝山\寿县17-09-01                  #
#                          25\程序\无线节点程序\code\Projects\zstack\Samples\ #
#                          SampleApp\CC2530DB\..\..\..\..\..\Components\stack #
#                          \sapi\" -I "D:\简宝山\寿县17-09-01                 #
#                          25\程序\无线节点程序\code\Projects\zstack\Samples\ #
#                          SampleApp\CC2530DB\..\..\..\..\..\Components\stack #
#                          \sec\" -I "D:\简宝山\寿县17-09-01                  #
#                          25\程序\无线节点程序\code\Projects\zstack\Samples\ #
#                          SampleApp\CC2530DB\..\..\..\..\..\Components\stack #
#                          \sys\" -I "D:\简宝山\寿县17-09-01                  #
#                          25\程序\无线节点程序\code\Projects\zstack\Samples\ #
#                          SampleApp\CC2530DB\..\..\..\..\..\Components\stack #
#                          \zdo\" -I "D:\简宝山\寿县17-09-01                  #
#                          25\程序\无线节点程序\code\Projects\zstack\Samples\ #
#                          SampleApp\CC2530DB\..\..\..\..\..\Components\zmac\ #
#                          " -I "D:\简宝山\寿县17-09-01                       #
#                          25\程序\无线节点程序\code\Projects\zstack\Samples\ #
#                          SampleApp\CC2530DB\..\..\..\..\..\Components\zmac\ #
#                          f8w\" -Ohz --require_prototypes                    #
#    List file          =  D:\简宝山\寿县17-09-01 25\程序\无线节点程序\code\P #
#                          rojects\zstack\Samples\SampleApp\CC2530DB\DemoEB\L #
#                          ist\SampleApp.lst                                  #
#    Object file        =  D:\简宝山\寿县17-09-01 25\程序\无线节点程序\code\P #
#                          rojects\zstack\Samples\SampleApp\CC2530DB\DemoEB\O #
#                          bj\SampleApp.r51                                   #
#                                                                             #
#                                                                             #
###############################################################################

D:\简宝山\寿县17-09-01 25\程序\无线节点程序\code\Projects\zstack\Samples\SampleApp\Source\SampleApp.c
      1          /**************************************************************************************************
      2            Filename:       SampleApp.c
      3            Revised:        $Date: 2009-03-18 15:56:27 -0700 (Wed, 18 Mar 2009) $
      4            Revision:       $Revision: 19453 $
      5          
      6            Description:    Sample Application (no Profile).
      7          
      8          
      9            Copyright 2007 Texas Instruments Incorporated. All rights reserved.
     10          
     11            IMPORTANT: Your use of this Software is limited to those specific rights
     12            granted under the terms of a software license agreement between the user
     13            who downloaded the software, his/her employer (which must be your employer)
     14            and Texas Instruments Incorporated (the "License").  You may not use this
     15            Software unless you agree to abide by the terms of the License. The License
     16            limits your use, and you acknowledge, that the Software may not be modified,
     17            copied or distributed unless embedded on a Texas Instruments microcontroller
     18            or used solely and exclusively in conjunction with a Texas Instruments radio
     19            frequency transceiver, which is integrated into your product.  Other than for
     20            the foregoing purpose, you may not use, reproduce, copy, prepare derivative
     21            works of, modify, distribute, perform, display or sell this Software and/or
     22            its documentation for any purpose.
     23          
     24            YOU FURTHER ACKNOWLEDGE AND AGREE THAT THE SOFTWARE AND DOCUMENTATION ARE
     25            PROVIDED AS IS?WITHOUT WARRANTY OF ANY KIND, EITHER EXPRESS OR IMPLIED,
     26            INCLUDING WITHOUT LIMITATION, ANY WARRANTY OF MERCHANTABILITY, TITLE,
     27            NON-INFRINGEMENT AND FITNESS FOR A PARTICULAR PURPOSE. IN NO EVENT SHALL
     28            TEXAS INSTRUMENTS OR ITS LICENSORS BE LIABLE OR OBLIGATED UNDER CONTRACT,
     29            NEGLIGENCE, STRICT LIABILITY, CONTRIBUTION, BREACH OF WARRANTY, OR OTHER
     30            LEGAL EQUITABLE THEORY ANY DIRECT OR INDIRECT DAMAGES OR EXPENSES
     31            INCLUDING BUT NOT LIMITED TO ANY INCIDENTAL, SPECIAL, INDIRECT, PUNITIVE
     32            OR CONSEQUENTIAL DAMAGES, LOST PROFITS OR LOST DATA, COST OF PROCUREMENT
     33            OF SUBSTITUTE GOODS, TECHNOLOGY, SERVICES, OR ANY CLAIMS BY THIRD PARTIES
     34            (INCLUDING BUT NOT LIMITED TO ANY DEFENSE THEREOF), OR OTHER SIMILAR COSTS.
     35          
     36            Should you have any questions regarding your right to use this Software,
     37            contact Texas Instruments Incorporated at www.TI.com.
     38          **************************************************************************************************/
     39          
     40          /*********************************************************************
     41            This application isn't intended to do anything useful, it is
     42            intended to be a simple example of an application's structure.
     43          
     44            This application sends it's messages either as broadcast or
     45            broadcast filtered group messages.  The other (more normal)
     46            message addressing is unicast.  Most of the other sample
     47            applications are written to support the unicast message model.
     48          
     49            Key control:
     50              SW1:  Sends a flash command to all devices in Group 1.
     51              SW2:  Adds/Removes (toggles) this device in and out
     52                    of Group 1.  This will enable and disable the
     53                    reception of the flash command.
     54          *********************************************************************/
     55          
     56          /*********************************************************************
     57           * INCLUDES
     58           */
     59          #include "OSAL.h"
     60          #include "ZGlobals.h"
     61          #include "AF.h"
     62          #include "aps_groups.h"
     63          #include "ZDApp.h"
     64          
     65          #include "SampleApp.h"
     66          #include "SampleAppHw.h"
     67          
     68          #include "OnBoard.h"
     69          
     70          /* HAL */
     71          #include "hal_lcd.h"
     72          #include "hal_led.h"
     73          #include "hal_key.h"
     74          
     75          #include  "MT_UART.h" //此处用于串口
     76          #include  "MT.h"
     77          #include "wdt.h"
     78          #include "adc.h"
     79          
     80          #include "APSMEDE.h"
     81          #include "AddrMgr.h"
     82          
     83          #include <stdio.h>
     84          #include <stdlib.h>
     85          #include <string.h>
     86          
     87          #include "osal_nv.h"
     88          
     89          /*********************************************************************
     90           * MACROS（宏定义）
     91           */
     92          #define DATASENSOR_COOR  67
     93          #define DATASENSOR_LEN  27
     94          
     95          #define DATA_OFFSET_ID    5
     96          #define DATA_OFFSET_T0    9
     97          #define DATA_OFFSET_U     14
     98          #define DATA_OFFSET_GH    18
     99          
    100          #define COOR_DATA_LEN   67
    101          
    102          /* AD采样模拟开关通道 */
    103          #define STDR_CHANNEL   0 //标准电阻
    104          #define T0_CHANNEL     1 //温度
    105          #define U_CHANNEL      2 //湿度
    106          #define GH_CHANNEL     3 //光合表
    107          
    108          #define AD_VREF         1.25 //AD参考电压
    109          
    110          /*********************************************************************
    111           * CONSTANTS
    112           */
    113          
    114          /*********************************************************************
    115           * TYPEDEFS(类型定义)
    116           */
    117          typedef struct
    118          {
    119            int temperature;
    120            int humidity;
    121            int photosyn; //光合量
    122          }dataType_t;
    123          
    124          /*********************************************************************
    125           * GLOBAL VARIABLES(全局变量)
    126           */
    127          #if (!defined (ZDO_COORDINATOR)) && (!defined (RTR_NWK))  //终端节点
    128          
    129          /*入网超时管理*/    /* 16.8.5适当调大离线时间限制，防止只选中单通道时重启时间过短，注意不能超过255 */
    130          #define ORPHAN_MAX   (/*30*/60)   //离线时间限制
    131          uint8 orphan=0;  //孤立节点计数，超过一定时间未连接到网络时重启设备
    132          //uint8 heart=0;   //心跳包计数，超过一定时间未接收到心跳包则重启设备
    133          //uint8 heart_open=0;  //心跳包开关
    134          
    135          #endif //终端
    136          

   \                                 In  segment XDATA_Z, align 1, keep-with-next
    137          int debug = 0; //调试信息开关：1 开，0 关，默认关
   \                     debug:
   \   000000                DS 2
   \   000002                REQUIRE __INIT_XDATA_Z
    138          

   \                                 In  segment XDATA_Z, align 1, keep-with-next
    139          int sensor_id = 0; //传感器ID
   \                     sensor_id:
   \   000000                DS 2
   \   000002                REQUIRE __INIT_XDATA_Z
    140          

   \                                 In  segment XDATA_Z, align 1, keep-with-next
    141          float gh_factor = 0; //光合表系数
   \                     gh_factor:
   \   000000                DS 4
   \   000004                REQUIRE __INIT_XDATA_Z
    142          

   \                                 In  segment XDATA_Z, align 1, keep-with-next
    143          int rs_flag = 0; //复位标志，1 复位，0 无操作
   \                     rs_flag:
   \   000000                DS 2
   \   000002                REQUIRE __INIT_XDATA_Z
    144          

   \                                 In  segment XDATA_Z, align 1, keep-with-next
    145          uint8 dev_id[10] = {0}; //保存终端设备ID
   \                     dev_id:
   \   000000                DS 10
   \   00000A                REQUIRE __INIT_XDATA_Z
    146          

   \                                 In  segment XDATA_Z, align 1, keep-with-next
    147          uint8 dev_gh[10] = {0}; //保存终端设备光合表系数
   \                     dev_gh:
   \   000000                DS 10
   \   00000A                REQUIRE __INIT_XDATA_Z
    148          

   \                                 In  segment XDATA_Z, align 1, keep-with-next
    149          uint8 dev_wddt[10] = {0}; //保存终端设备温度订正
   \                     dev_wddt:
   \   000000                DS 10
   \   00000A                REQUIRE __INIT_XDATA_Z
    150          

   \                                 In  segment XDATA_Z, align 1, keep-with-next
    151          float cal_t0 = 0; //温度订正值变量
   \                     cal_t0:
   \   000000                DS 4
   \   000004                REQUIRE __INIT_XDATA_Z
    152          
    153          #if defined (ZDO_COORDINATOR) || defined (RTR_NWK) //协调器

   \                                 In  segment XDATA_I, align 1, keep-with-next
    154          char data_coor[128]={"BG,ID001,-600,099,1234,ID002,-600,099,1234,ID003,-600,099,1234,ED\r\n"}; //协调器数据->主采集器
   \                     data_coor:
   \   000000                DS 128
   \   000080                REQUIRE `?<Initializer for data_coor>`
   \   000080                REQUIRE __INIT_XDATA_I

   \                                 In  segment XDATA_Z, align 1, keep-with-next
    155          dataType_t coordi[3]; //协调器数据变量
   \                     coordi:
   \   000000                DS 18
   \   000012                REQUIRE __INIT_XDATA_Z
    156          #else //终端
    157          char data_sensor[128]={"BG,ID001,-600,099,1234,ED\r\n"}; //终端传感器数据->协调器
    158          dataType_t sensor; //传感器数据变量
    159          #endif
    160          
    161          // This list should be filled with Application specific Cluster IDs.

   \                                 In  segment XDATA_ROM_C, align 1
    162          const cId_t SampleApp_ClusterList[SAMPLEAPP_MAX_CLUSTERS] =
   \                     SampleApp_ClusterList:
   \   000000   0100         DW 1
   \   000002   0200         DW 2
   \   000004   0000         DW 0
   \   000006   0000         DW 0
    163          {
    164            SAMPLEAPP_PERIODIC_CLUSTERID,
    165            SAMPLEAPP_FLASH_CLUSTERID
    166          };
    167          

   \                                 In  segment XDATA_ROM_C, align 1
    168          const SimpleDescriptionFormat_t SampleApp_SimpleDesc =
   \                     SampleApp_SimpleDesc:
   \   000000   14           DB 20
   \   000001   080F         DW 3848
   \   000003   0100         DW 1
   \   000005   00           DB 0
   \   000006   04           DB 4
   \   000007   ....         DW SampleApp_ClusterList
   \   000009   04           DB 4
   \   00000A   ....         DW SampleApp_ClusterList
    169          {
    170            SAMPLEAPP_ENDPOINT,              //  int Endpoint;
    171            SAMPLEAPP_PROFID,                //  uint16 AppProfId[2];
    172            SAMPLEAPP_DEVICEID,              //  uint16 AppDeviceId[2];
    173            SAMPLEAPP_DEVICE_VERSION,        //  int   AppDevVer:4;
    174            SAMPLEAPP_FLAGS,                 //  int   AppFlags:4;
    175            SAMPLEAPP_MAX_CLUSTERS,          //  uint8  AppNumInClusters;
    176            (cId_t *)SampleApp_ClusterList,  //  uint8 *pAppInClusterList;
    177            SAMPLEAPP_MAX_CLUSTERS,          //  uint8  AppNumInClusters;
    178            (cId_t *)SampleApp_ClusterList   //  uint8 *pAppInClusterList;
    179          };
    180          
    181          // This is the Endpoint/Interface description.  It is defined here, but
    182          // filled-in in SampleApp_Init().  Another way to go would be to fill
    183          // in the structure here and make it a "const" (in code space).  The
    184          // way it's defined in this sample app it is define in RAM.

   \                                 In  segment XDATA_Z, align 1, keep-with-next
    185          endPointDesc_t SampleApp_epDesc;
   \                     SampleApp_epDesc:
   \   000000                DS 6
   \   000006                REQUIRE __INIT_XDATA_Z
    186          
    187          /*********************************************************************
    188           * EXTERNAL VARIABLES
    189           */
    190          
    191          /*********************************************************************
    192           * EXTERNAL FUNCTIONS
    193           */
    194          
    195          /*********************************************************************
    196           * LOCAL VARIABLES
    197           */

   \                                 In  segment XDATA_Z, align 1, keep-with-next
    198          uint8 SampleApp_TaskID;   // Task ID for internal task/event processing
   \                     SampleApp_TaskID:
   \   000000                DS 1
   \   000001                REQUIRE __INIT_XDATA_Z
    199                                    // This variable will be received when
    200                                    // SampleApp_Init() is called.

   \                                 In  segment XDATA_Z, align 1, keep-with-next
    201          devStates_t SampleApp_NwkState;
   \                     SampleApp_NwkState:
   \   000000                DS 1
   \   000001                REQUIRE __INIT_XDATA_Z
    202          

   \                                 In  segment XDATA_Z, align 1, keep-with-next
    203          uint8 SampleApp_TransID;  // This is the unique message ID (counter)
   \                     SampleApp_TransID:
   \   000000                DS 1
   \   000001                REQUIRE __INIT_XDATA_Z
    204          

   \                                 In  segment XDATA_Z, align 1, keep-with-next
    205          afAddrType_t SampleApp_Periodic_DstAddr;
   \                     SampleApp_Periodic_DstAddr:
   \   000000                DS 12
   \   00000C                REQUIRE __INIT_XDATA_Z

   \                                 In  segment XDATA_Z, align 1, keep-with-next
    206          afAddrType_t SampleApp_Flash_DstAddr;
   \                     SampleApp_Flash_DstAddr:
   \   000000                DS 12
   \   00000C                REQUIRE __INIT_XDATA_Z

   \                                 In  segment XDATA_Z, align 1, keep-with-next
    207          afAddrType_t Point_To_Point_DstAddr; //网蜂点对点通信定义
   \                     Point_To_Point_DstAddr:
   \   000000                DS 12
   \   00000C                REQUIRE __INIT_XDATA_Z
    208          

   \                                 In  segment XDATA_Z, align 1, keep-with-next
    209          aps_Group_t SampleApp_Group;
   \                     SampleApp_Group:
   \   000000                DS 18
   \   000012                REQUIRE __INIT_XDATA_Z
    210          

   \                                 In  segment XDATA_Z, align 1, keep-with-next
    211          uint8 SampleAppPeriodicCounter = 0;
   \                     SampleAppPeriodicCounter:
   \   000000                DS 1
   \   000001                REQUIRE __INIT_XDATA_Z

   \                                 In  segment XDATA_Z, align 1, keep-with-next
    212          uint8 SampleAppFlashCounter = 0;
   \                     SampleAppFlashCounter:
   \   000000                DS 1
   \   000001                REQUIRE __INIT_XDATA_Z
    213          
    214          /*********************************************************************
    215           * LOCAL FUNCTIONS
    216           */
    217          void SampleApp_HandleKeys( uint8 shift, uint8 keys );
    218          void SampleApp_MessageMSGCB( afIncomingMSGPacket_t *pckt );
    219          void SampleApp_SendPeriodicMessage(char *p, int len );
    220          void SampleApp_SendPointToPointMessage( char *p, int len ); //点对点发送函数
    221          void SampleApp_SerialCMD( mtOSALSerialData_t * MSGpkt); //串口数据处理函数
    222          void SendDataToCollector(char *ptr, int len); //串口向采集器发送数据
    223          void ReturnTorF(int a, int b);//指令回复'T'或'F'
    224          //void Order_Parse(char *str, int len, int flag); //协调器或串口指令解析
    225          
    226          /*********************************************************************
    227           * NETWORK LAYER CALLBACKS
    228           */
    229          
    230          /*********************************************************************
    231           * PUBLIC FUNCTIONS
    232           */
    233          
    234          /*********************************************************************
    235           * @fn      SampleApp_Init
    236           *
    237           * @brief   Initialization function for the Generic App Task.
    238           *          This is called during initialization and should contain
    239           *          any application specific initialization (ie. hardware
    240           *          initialization/setup, table initialization, power up
    241           *          notificaiton ... ).
    242           *          这是一个用户用于初始任务的函数，它是在系统初始化阶段被调用的，而且
    243           *          在调用它的时候，它里面应该有相应任务的初始化（也就是说，用户有什么
    244           *          初始化，都是放在这个函数里），比如：硬件初始化、数据表初始化、电源
    245           *          初始化等等。
    246           *
    247           * @param   task_id - the ID assigned by OSAL.  This ID should be
    248           *                    used to send messages and set timers.
    249           *
    250           * @return  none
    251           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
    252          void SampleApp_Init( uint8 task_id )
   \                     SampleApp_Init:
    253          {
   \   000000                REQUIRE ?V0
   \   000000                REQUIRE ?V1
   \   000000                REQUIRE ?V2
   \   000000   74F5         MOV     A,#-0xb
   \   000002   12....       LCALL   ?BANKED_ENTER_XDATA
   \   000005                ; Saved register size: 11
   \   000005                ; Auto size: 0
   \   000005   E9           MOV     A,R1
   \   000006   FE           MOV     R6,A
    254            SampleApp_TaskID = task_id;
   \   000007   90....       MOV     DPTR,#SampleApp_TaskID
   \   00000A   F0           MOVX    @DPTR,A
    255            SampleApp_NwkState = DEV_INIT;
   \   00000B   90....       MOV     DPTR,#SampleApp_NwkState
   \   00000E   7401         MOV     A,#0x1
   \   000010   F0           MOVX    @DPTR,A
    256            SampleApp_TransID = 0;
   \   000011   90....       MOV     DPTR,#SampleApp_TransID
   \   000014   E4           CLR     A
   \   000015   F0           MOVX    @DPTR,A
    257            
    258          #if defined (ZDO_COORDINATOR) || defined (RTR_NWK) //协调器
    259            osal_memset(coordi, 0, sizeof(dataType_t)*3); //协调器数据变量初始化
   \   000016                ; Setup parameters for call to function osal_memset
   \   000016   7C12         MOV     R4,#0x12
   \   000018   FD           MOV     R5,A
   \   000019   F9           MOV     R1,A
   \   00001A   7A..         MOV     R2,#coordi & 0xff
   \   00001C   7B..         MOV     R3,#(coordi >> 8) & 0xff
   \   00001E   12....       LCALL   ??osal_memset?relay  ; Banked call to: osal_memset
    260          #else //终端
    261            osal_memset(&sensor, 0, sizeof(dataType_t)); //传感器数据变量初始化
    262          #endif
    263            
    264            MT_UartInit(); //串口初始化
   \   000021                ; Setup parameters for call to function MT_UartInit
   \   000021   12....       LCALL   ??MT_UartInit?relay  ; Banked call to: MT_UartInit
    265            MT_UartRegisterTaskID(task_id); //登记任务号
   \   000024                ; Setup parameters for call to function MT_UartRegisterTaskID
   \   000024   EE           MOV     A,R6
   \   000025   F9           MOV     R1,A
   \   000026   12....       LCALL   ??MT_UartRegisterTaskID?relay; Banked call to: MT_UartRegisterTaskID
    266            printf("System init!\n"); //打印开机初始化信息
   \   000029                ; Setup parameters for call to function printf
   \   000029   7A..         MOV     R2,#`?<Constant "System init!\\n">` & 0xff
   \   00002B   7B..         MOV     R3,#(`?<Constant "System init!\\n">` >> 8) & 0xff
   \   00002D   12....       LCALL   ??printf?relay       ; Banked call to: printf
    267            
    268            ADC_Init(); //AD7705初始化，包括初始化SPI1和复位I/O引脚配置
   \   000030                ; Setup parameters for call to function ADC_Init
   \   000030   12....       LCALL   ??ADC_Init?relay     ; Banked call to: ADC_Init
    269            
    270            osal_start_reload_timer( SampleApp_TaskID, SAMPLEAPP_SEND_PERIODIC_MSG_EVT, SAMPLEAPP_SEND_PERIODIC_MSG_TIMEOUT ); //周期5s定时器
   \   000033                ; Setup parameters for call to function osal_start_reload_timer
   \   000033   7C88         MOV     R4,#-0x78
   \   000035   7D13         MOV     R5,#0x13
   \   000037   7A01         MOV     R2,#0x1
   \   000039   7B00         MOV     R3,#0x0
   \   00003B   90....       MOV     DPTR,#SampleApp_TaskID
   \   00003E   E0           MOVX    A,@DPTR
   \   00003F   F9           MOV     R1,A
   \   000040   12....       LCALL   ??osal_start_reload_timer?relay; Banked call to: osal_start_reload_timer
    271            
    272            osal_start_reload_timer( SampleApp_TaskID, SAMPLEAPP_WDT_PERIODIC_MSG_EVT, SAMPLEAPP_FEEDWDT_PERIODIC_TIMEOUT ); //周期500ms定时器
   \   000043                ; Setup parameters for call to function osal_start_reload_timer
   \   000043   7CF4         MOV     R4,#-0xc
   \   000045   7D01         MOV     R5,#0x1
   \   000047   7A02         MOV     R2,#0x2
   \   000049   7B00         MOV     R3,#0x0
   \   00004B   90....       MOV     DPTR,#SampleApp_TaskID
   \   00004E   E0           MOVX    A,@DPTR
   \   00004F   F9           MOV     R1,A
   \   000050   12....       LCALL   ??osal_start_reload_timer?relay; Banked call to: osal_start_reload_timer
    273                      
    274            WDT_Init();//看门狗初始化，放狗
   \   000053                ; Setup parameters for call to function WDT_Init
   \   000053   12....       LCALL   ??WDT_Init?relay     ; Banked call to: WDT_Init
    275            
    276          #if !(defined (ZDO_COORDINATOR)) || !(defined (RTR_NWK)) //终端
    277            /* 初始化保存系统参数的flash区域 */
    278            if(SUCCESS != osal_nv_item_init(DEVICE_ID, DEVICE_ID_LEN, NULL)) //设备ID存入flash区域初始化
    279              printf("ID flash init failed!!\n");
    280            
    281            if(SUCCESS !=osal_nv_item_init(DEVICE_GH, DEVICE_GH_LEN, NULL)) //设备光合表系数存入flash区域初始化
    282              printf("GH flash init failed!!\n");
    283            
    284            if(SUCCESS !=osal_nv_item_init(DEVICE_WDDT, DEVICE_WDDT_LEN, NULL)) //设备温度订正值存入flash区域初始化
    285              printf("WDDT flash init failed!!\n");
    286            
    287            /* 终端传感器读入系统初始化参数，设备ID与光合表系数 */
    288            if(SUCCESS == osal_nv_read(DEVICE_ID, 0, DEVICE_ID_LEN, dev_id)) //读入flash中存放的设备ID
    289              sensor_id = atoi(dev_id);
    290            else
    291              printf("ID flash read failed!!\n");
    292            
    293            if(SUCCESS == osal_nv_read(DEVICE_GH, 0, DEVICE_GH_LEN, dev_gh)) //读入flash中存放的设备光合表系数
    294              gh_factor = atof(dev_gh);
    295            else
    296              printf("GH flash read failed!!\n");
    297            
    298            if(SUCCESS == osal_nv_read(DEVICE_WDDT, 0, DEVICE_WDDT_LEN, dev_wddt)) //读入flash中存放的设备温度订正值
    299              cal_t0 = atof(dev_wddt);
    300            else
    301              printf("WDDT flash read failed!!\n");
    302            
    303          #endif
    304            
    305            // Device hardware initialization can be added here or in main() (Zmain.c).
    306            // If the hardware is application specific - add it here.
    307            // If the hardware is other parts of the device add it in main().
    308          
    309           #if defined ( BUILD_ALL_DEVICES )
    310            // The "Demo" target is setup to have BUILD_ALL_DEVICES and HOLD_AUTO_START
    311            // We are looking at a jumper (defined in SampleAppHw.c) to be jumpered
    312            // together - if they are - we will start up a coordinator. Otherwise,
    313            // the device will start as a router.
    314            if ( readCoordinatorJumper() )
   \   000056                ; Setup parameters for call to function readCoordinatorJumper
   \   000056   12....       LCALL   ??readCoordinatorJumper?relay; Banked call to: readCoordinatorJumper
   \   000059   E9           MOV     A,R1
   \   00005A   90....       MOV     DPTR,#zgDeviceLogicalType
   \   00005D   6003         JZ      ??SampleApp_Init_0
    315              zgDeviceLogicalType = ZG_DEVICETYPE_COORDINATOR;
   \   00005F   E4           CLR     A
   \   000060   8002         SJMP    ??SampleApp_Init_1
    316            else
    317              zgDeviceLogicalType = ZG_DEVICETYPE_ROUTER;
   \                     ??SampleApp_Init_0:
   \   000062   7401         MOV     A,#0x1
   \                     ??SampleApp_Init_1:
   \   000064   F0           MOVX    @DPTR,A
    318          #endif // BUILD_ALL_DEVICES
    319          
    320          #if defined ( HOLD_AUTO_START )
    321            // HOLD_AUTO_START is a compile option that will surpress ZDApp
    322            //  from starting the device and wait for the application to
    323            //  start the device.
    324            ZDOInitDevice(0);
   \   000065                ; Setup parameters for call to function ZDOInitDevice
   \   000065   7A00         MOV     R2,#0x0
   \   000067   7B00         MOV     R3,#0x0
   \   000069   12....       LCALL   ??ZDOInitDevice?relay; Banked call to: ZDOInitDevice
    325          #endif
    326          
    327            // Setup for the periodic message's destination address
    328            // Broadcast to everyone
    329            SampleApp_Periodic_DstAddr.addrMode = (afAddrMode_t)AddrBroadcast;
   \   00006C   90....       MOV     DPTR,#SampleApp_Periodic_DstAddr + 8
   \   00006F   740F         MOV     A,#0xf
   \   000071   F0           MOVX    @DPTR,A
    330            SampleApp_Periodic_DstAddr.endPoint = SAMPLEAPP_ENDPOINT;
   \   000072   A3           INC     DPTR
   \   000073   7414         MOV     A,#0x14
   \   000075   F0           MOVX    @DPTR,A
    331            SampleApp_Periodic_DstAddr.addr.shortAddr = 0xFFFF;
   \   000076   90....       MOV     DPTR,#SampleApp_Periodic_DstAddr
   \   000079   74FF         MOV     A,#-0x1
   \   00007B   F0           MOVX    @DPTR,A
   \   00007C   A3           INC     DPTR
   \   00007D   F0           MOVX    @DPTR,A
    332          
    333            // Setup for the flash command's destination address - Group 1
    334            SampleApp_Flash_DstAddr.addrMode = (afAddrMode_t)afAddrGroup;
   \   00007E   90....       MOV     DPTR,#SampleApp_Flash_DstAddr + 8
   \   000081   7401         MOV     A,#0x1
   \   000083   F0           MOVX    @DPTR,A
    335            SampleApp_Flash_DstAddr.endPoint = SAMPLEAPP_ENDPOINT;
   \   000084   A3           INC     DPTR
   \   000085   7414         MOV     A,#0x14
   \   000087   F0           MOVX    @DPTR,A
    336            SampleApp_Flash_DstAddr.addr.shortAddr = SAMPLEAPP_FLASH_GROUP;
   \   000088   90....       MOV     DPTR,#SampleApp_Flash_DstAddr
   \   00008B   7401         MOV     A,#0x1
   \   00008D   F0           MOVX    @DPTR,A
   \   00008E   A3           INC     DPTR
   \   00008F   E4           CLR     A
   \   000090   F0           MOVX    @DPTR,A
    337            
    338            // 网蜂点对点通讯定义
    339            Point_To_Point_DstAddr.addrMode = (afAddrMode_t)Addr16Bit;//点播
   \   000091   90....       MOV     DPTR,#Point_To_Point_DstAddr + 8
   \   000094   7402         MOV     A,#0x2
   \   000096   F0           MOVX    @DPTR,A
    340            Point_To_Point_DstAddr.endPoint = SAMPLEAPP_ENDPOINT;
   \   000097   A3           INC     DPTR
   \   000098   7414         MOV     A,#0x14
   \   00009A   F0           MOVX    @DPTR,A
    341            Point_To_Point_DstAddr.addr.shortAddr = 0x0000; //发给协调器
   \   00009B   90....       MOV     DPTR,#Point_To_Point_DstAddr
   \   00009E   E4           CLR     A
   \   00009F   F0           MOVX    @DPTR,A
   \   0000A0   A3           INC     DPTR
   \   0000A1   F0           MOVX    @DPTR,A
    342          
    343            // Fill out the endpoint description.
    344            SampleApp_epDesc.endPoint = SAMPLEAPP_ENDPOINT;
   \   0000A2   90....       MOV     DPTR,#SampleApp_epDesc
   \   0000A5   7414         MOV     A,#0x14
   \   0000A7   F0           MOVX    @DPTR,A
    345            SampleApp_epDesc.task_id = &SampleApp_TaskID;
   \   0000A8   A3           INC     DPTR
   \   0000A9   74..         MOV     A,#SampleApp_TaskID & 0xff
   \   0000AB   F0           MOVX    @DPTR,A
   \   0000AC   A3           INC     DPTR
   \   0000AD   74..         MOV     A,#(SampleApp_TaskID >> 8) & 0xff
   \   0000AF   F0           MOVX    @DPTR,A
    346            SampleApp_epDesc.simpleDesc
    347                      = (SimpleDescriptionFormat_t *)&SampleApp_SimpleDesc;
   \   0000B0   A3           INC     DPTR
   \   0000B1   74..         MOV     A,#SampleApp_SimpleDesc & 0xff
   \   0000B3   F0           MOVX    @DPTR,A
   \   0000B4   A3           INC     DPTR
   \   0000B5   74..         MOV     A,#(SampleApp_SimpleDesc >> 8) & 0xff
   \   0000B7   F0           MOVX    @DPTR,A
    348            SampleApp_epDesc.latencyReq = noLatencyReqs;
   \   0000B8   A3           INC     DPTR
   \   0000B9   E4           CLR     A
   \   0000BA   F0           MOVX    @DPTR,A
    349          
    350            // Register the endpoint description with the AF
    351            afRegister( &SampleApp_epDesc );
   \   0000BB                ; Setup parameters for call to function afRegister
   \   0000BB   7A..         MOV     R2,#SampleApp_epDesc & 0xff
   \   0000BD   7B..         MOV     R3,#(SampleApp_epDesc >> 8) & 0xff
   \   0000BF   12....       LCALL   ??afRegister?relay   ; Banked call to: afRegister
    352          
    353            // Register for all key events - This app will handle all key events
    354            RegisterForKeys( SampleApp_TaskID );
   \   0000C2                ; Setup parameters for call to function RegisterForKeys
   \   0000C2   90....       MOV     DPTR,#SampleApp_TaskID
   \   0000C5   E0           MOVX    A,@DPTR
   \   0000C6   F9           MOV     R1,A
   \   0000C7   12....       LCALL   ??RegisterForKeys?relay; Banked call to: RegisterForKeys
    355          
    356            // By default, all devices start out in Group 1
    357            SampleApp_Group.ID = 0x0001;
   \   0000CA   90....       MOV     DPTR,#SampleApp_Group
   \   0000CD   7401         MOV     A,#0x1
   \   0000CF   F0           MOVX    @DPTR,A
   \   0000D0   A3           INC     DPTR
   \   0000D1   E4           CLR     A
   \   0000D2   F0           MOVX    @DPTR,A
    358            osal_memcpy( SampleApp_Group.name, "Group 1", 7  );
   \   0000D3                ; Setup parameters for call to function osal_memcpy
   \   0000D3   75....       MOV     ?V0,#`?<Constant "Group 1">` & 0xff
   \   0000D6   75....       MOV     ?V1,#(`?<Constant "Group 1">` >> 8) & 0xff
   \   0000D9   F5..         MOV     ?V2,A
   \   0000DB   78..         MOV     R0,#?V0
   \   0000DD   12....       LCALL   ?PUSH_XSTACK_I_THREE
   \   0000E0   7C07         MOV     R4,#0x7
   \   0000E2   7D00         MOV     R5,#0x0
   \   0000E4   7A..         MOV     R2,#(SampleApp_Group + 2) & 0xff
   \   0000E6   7B..         MOV     R3,#((SampleApp_Group + 2) >> 8) & 0xff
   \   0000E8   12....       LCALL   ??osal_memcpy?relay  ; Banked call to: osal_memcpy
   \   0000EB   7403         MOV     A,#0x3
   \   0000ED   12....       LCALL   ?DEALLOC_XSTACK8
    359            aps_AddGroup( SAMPLEAPP_ENDPOINT, &SampleApp_Group );
   \   0000F0                ; Setup parameters for call to function aps_AddGroup
   \   0000F0   7A..         MOV     R2,#SampleApp_Group & 0xff
   \   0000F2   7B..         MOV     R3,#(SampleApp_Group >> 8) & 0xff
   \   0000F4   7914         MOV     R1,#0x14
   \   0000F6   12....       LCALL   ??aps_AddGroup?relay ; Banked call to: aps_AddGroup
    360          
    361          #if defined ( LCD_SUPPORTED )
    362            HalLcdWriteString( "SampleApp", HAL_LCD_LINE_1 );
   \   0000F9                ; Setup parameters for call to function HalLcdWriteString
   \   0000F9   7901         MOV     R1,#0x1
   \   0000FB   7A..         MOV     R2,#`?<Constant "SampleApp">` & 0xff
   \   0000FD   7B..         MOV     R3,#(`?<Constant "SampleApp">` >> 8) & 0xff
   \   0000FF   12....       LCALL   ??HalLcdWriteString?relay; Banked call to: HalLcdWriteString
    363          #endif
    364          }
   \   000102   7F03         MOV     R7,#0x3
   \   000104   02....       LJMP    ?BANKED_LEAVE_XDATA
    365          
    366          /*********************************************************************
    367           * @fn      SampleApp_ProcessEvent
    368           *
    369           * @brief   Generic Application Task event processor.  This function
    370           *          is called to process all events for the task.  Events
    371           *          include timers, messages and any other user defined events.
    372           *          事件处理函数（所有的事件都是它管理）
    373           *
    374           * @param   task_id  - The OSAL assigned task ID.
    375           * @param   events - events to process.  This is a bit map and can
    376           *                   contain more than one event.
    377           *
    378           * @return  none
    379           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
    380          uint16 SampleApp_ProcessEvent( uint8 task_id, uint16 events )
   \                     SampleApp_ProcessEvent:
    381          {
   \   000000                REQUIRE ?V0
   \   000000                REQUIRE ?V1
   \   000000                REQUIRE ?V2
   \   000000                REQUIRE ?V3
   \   000000   74F4         MOV     A,#-0xc
   \   000002   12....       LCALL   ?BANKED_ENTER_XDATA
   \   000005                ; Saved register size: 12
   \   000005                ; Auto size: 0
   \   000005   8A..         MOV     ?V0,R2
   \   000007   8B..         MOV     ?V1,R3
    382            afIncomingMSGPacket_t *MSGpkt;
    383            (void)task_id;  // Intentionally unreferenced parameter
    384          
    385            if ( events & SYS_EVENT_MSG )
   \   000009   EB           MOV     A,R3
   \   00000A   5480         ANL     A,#0x80
   \   00000C   7003         JNZ     $+5
   \   00000E   02....       LJMP    ??SampleApp_ProcessEvent_0 & 0xFFFF
    386            {
    387              MSGpkt = (afIncomingMSGPacket_t *)osal_msg_receive( SampleApp_TaskID );
   \   000011                ; Setup parameters for call to function osal_msg_receive
   \   000011   800E         SJMP    ??SampleApp_ProcessEvent_1
    388              while ( MSGpkt )
    389              {
    390                switch ( MSGpkt->hdr.event )
    391                {
    392                  case CMD_SERIAL_MSG: //串口收到数据后由 MT_UART 层传递过来的数据，用网蜂方法接收，编译时不定义 MT相关内容 
    393                    SampleApp_SerialCMD((mtOSALSerialData_t *)MSGpkt);
    394                    break;
    395          
    396                  // Received when a messages is received (OTA) for this endpoint
    397                  case AF_INCOMING_MSG_CMD: //无线数据接收
    398                    SampleApp_MessageMSGCB( MSGpkt );
    399                    break;
    400          
    401                  // Received whenever the device changes state in the network
    402                  case ZDO_STATE_CHANGE:
    403                    SampleApp_NwkState = (devStates_t)(MSGpkt->hdr.status);
    404                    if ( (SampleApp_NwkState == DEV_ZB_COORD)
    405                        || (SampleApp_NwkState == DEV_ROUTER)
    406                        || (SampleApp_NwkState == DEV_END_DEVICE) ) //网络连接成功
    407                    {
    408                      printf("NET SUCCESS!\r\n");
    409                      switch(SampleApp_NwkState)   //根据_NIB结构中的内容得到设备的短地址、父节点短地址、信道号和网络PanID，并通过串口打印出去
    410                      {
    411                      case DEV_ROUTER:  //路由器节点
    412                        printf("Router:0x%04X\r\nParent:0x%04X\r\nChannel:%d\r\nPanID:0x%04X\r\n",
    413                                _NIB.nwkDevAddress,_NIB.nwkCoordAddress,_NIB.nwkLogicalChannel,_NIB.nwkPanId);
    414          
    415                        printf("IEEE:%02X%02X%02X%02X%02X%02X%02X%02X\r\n",      //IEEE地址
    416                                aExtendedAddress[7],aExtendedAddress[6],aExtendedAddress[5],aExtendedAddress[4],
    417                                aExtendedAddress[3],aExtendedAddress[2],aExtendedAddress[1],aExtendedAddress[0]);
    418          
    419                        printf("Parent IEEE:%02X%02X%02X%02X%02X%02X%02X%02X\r\n",      //父节点IEEE地址
    420                                _NIB.nwkCoordExtAddress[7],_NIB.nwkCoordExtAddress[6],_NIB.nwkCoordExtAddress[5],_NIB.nwkCoordExtAddress[4],
    421                                _NIB.nwkCoordExtAddress[3],_NIB.nwkCoordExtAddress[2],_NIB.nwkCoordExtAddress[1],_NIB.nwkCoordExtAddress[0]);
    422          
    423                        break;
    424                      case DEV_END_DEVICE: //终端节点
    425                        printf("EndDevice:0x%04X\r\nParent:0x%04X\r\nChannel:%d\r\nPanID:0x%04X\r\n",
    426                                _NIB.nwkDevAddress,_NIB.nwkCoordAddress,_NIB.nwkLogicalChannel,_NIB.nwkPanId);
    427          
    428                        printf("IEEE:%02X%02X%02X%02X%02X%02X%02X%02X\r\n",      //IEEE地址
    429                                aExtendedAddress[7],aExtendedAddress[6],aExtendedAddress[5],aExtendedAddress[4],
    430                                aExtendedAddress[3],aExtendedAddress[2],aExtendedAddress[1],aExtendedAddress[0]);
    431          
    432                        printf("Parent IEEE:%02X%02X%02X%02X%02X%02X%02X%02X\r\n",      //父节点IEEE地址
    433                                _NIB.nwkCoordExtAddress[7],_NIB.nwkCoordExtAddress[6],_NIB.nwkCoordExtAddress[5],_NIB.nwkCoordExtAddress[4],
    434                                _NIB.nwkCoordExtAddress[3],_NIB.nwkCoordExtAddress[2],_NIB.nwkCoordExtAddress[1],_NIB.nwkCoordExtAddress[0]);
    435          
    436                        break;
    437                      case DEV_ZB_COORD:  //协调器
    438                        printf("Coordinator:0x%04X\r\nChannel:%d\r\nPanID:0x%04X\r\n",
    439                                _NIB.nwkDevAddress,_NIB.nwkLogicalChannel,_NIB.nwkPanId);
    440          
    441                        printf("IEEE:%02X%02X%02X%02X%02X%02X%02X%02X\r\n",      //IEEE地址
    442                                aExtendedAddress[7],aExtendedAddress[6],aExtendedAddress[5],aExtendedAddress[4],
    443                                aExtendedAddress[3],aExtendedAddress[2],aExtendedAddress[1],aExtendedAddress[0]);
    444          
    445                        break;
    446                      default:
    447                        break;
    448                      }
    449                    }
    450                    else
    451                    {
    452                      // Device is no longer in the network
    453                      printf("NO NET\r\n");
   \                     ??SampleApp_ProcessEvent_2:
   \   000013                ; Setup parameters for call to function printf
   \   000013   7A..         MOV     R2,#`?<Constant "NO NET\\r\\n">` & 0xff
   \   000015   7B..         MOV     R3,#(`?<Constant "NO NET\\r\\n">` >> 8) & 0xff
   \   000017   12....       LCALL   ??printf?relay       ; Banked call to: printf
    454                      
    455          #if (!defined (ZDO_COORDINATOR)) && (!defined (RTR_NWK))  //终端节点          
    456                      orphan++;  //孤立累计
    457                      if(orphan>ORPHAN_MAX)  //超过指定次数入网失败则重启设备
    458                      {
    459                        rs_flag = 1; //停止喂狗，致使系统复位
    460                      }
    461          #endif //终端
    462                    }
    463                    break;
    464          
    465                  default:
    466                    break;
    467                }
    468          
    469                // Release the memory
    470                osal_msg_deallocate( (uint8 *)MSGpkt );
   \                     ??SampleApp_ProcessEvent_3:
   \   00001A                ; Setup parameters for call to function osal_msg_deallocate
   \   00001A   EE           MOV     A,R6
   \   00001B   FA           MOV     R2,A
   \   00001C   EF           MOV     A,R7
   \   00001D   FB           MOV     R3,A
   \   00001E   12....       LCALL   ??osal_msg_deallocate?relay; Banked call to: osal_msg_deallocate
    471          
    472                // Next - if one is available
    473                MSGpkt = (afIncomingMSGPacket_t *)osal_msg_receive( SampleApp_TaskID );
   \   000021                ; Setup parameters for call to function osal_msg_receive
   \                     ??SampleApp_ProcessEvent_1:
   \   000021   90....       MOV     DPTR,#SampleApp_TaskID
   \   000024   E0           MOVX    A,@DPTR
   \   000025   F9           MOV     R1,A
   \   000026   12....       LCALL   ??osal_msg_receive?relay; Banked call to: osal_msg_receive
   \   000029   8A..         MOV     ?V2,R2
   \   00002B   8B..         MOV     ?V3,R3
   \   00002D   AE..         MOV     R6,?V2
   \   00002F   AF..         MOV     R7,?V3
   \   000031   EE           MOV     A,R6
   \   000032   4F           ORL     A,R7
   \   000033   7003         JNZ     $+5
   \   000035   02....       LJMP    ??SampleApp_ProcessEvent_4 & 0xFFFF
   \   000038   8E82         MOV     DPL,R6
   \   00003A   8F83         MOV     DPH,R7
   \   00003C   E0           MOVX    A,@DPTR
   \   00003D   14           DEC     A
   \   00003E   600A         JZ      ??SampleApp_ProcessEvent_5
   \   000040   24E7         ADD     A,#-0x19
   \   000042   600F         JZ      ??SampleApp_ProcessEvent_6
   \   000044   2449         ADD     A,#0x49
   \   000046   6014         JZ      ??SampleApp_ProcessEvent_7
   \   000048   80D0         SJMP    ??SampleApp_ProcessEvent_3
   \                     ??SampleApp_ProcessEvent_5:
   \   00004A                ; Setup parameters for call to function SampleApp_SerialCMD
   \   00004A   EE           MOV     A,R6
   \   00004B   FA           MOV     R2,A
   \   00004C   EF           MOV     A,R7
   \   00004D   FB           MOV     R3,A
   \   00004E   12....       LCALL   ??SampleApp_SerialCMD?relay; Banked call to: SampleApp_SerialCMD
   \   000051   80C7         SJMP    ??SampleApp_ProcessEvent_3
   \                     ??SampleApp_ProcessEvent_6:
   \   000053                ; Setup parameters for call to function SampleApp_MessageMSGCB
   \   000053   EE           MOV     A,R6
   \   000054   FA           MOV     R2,A
   \   000055   EF           MOV     A,R7
   \   000056   FB           MOV     R3,A
   \   000057   12....       LCALL   ??SampleApp_MessageMSGCB?relay; Banked call to: SampleApp_MessageMSGCB
   \   00005A   80BE         SJMP    ??SampleApp_ProcessEvent_3
   \                     ??SampleApp_ProcessEvent_7:
   \   00005C   A3           INC     DPTR
   \   00005D   E0           MOVX    A,@DPTR
   \   00005E   90....       MOV     DPTR,#SampleApp_NwkState
   \   000061   F0           MOVX    @DPTR,A
   \   000062   6409         XRL     A,#0x9
   \   000064   600A         JZ      ??SampleApp_ProcessEvent_8
   \   000066   E0           MOVX    A,@DPTR
   \   000067   6407         XRL     A,#0x7
   \   000069   6005         JZ      ??SampleApp_ProcessEvent_8
   \   00006B   E0           MOVX    A,@DPTR
   \   00006C   6406         XRL     A,#0x6
   \   00006E   70A3         JNZ     ??SampleApp_ProcessEvent_2
   \                     ??SampleApp_ProcessEvent_8:
   \   000070                ; Setup parameters for call to function printf
   \   000070   7A..         MOV     R2,#`?<Constant "NET SUCCESS!\\r\\n">` & 0xff
   \   000072   7B..         MOV     R3,#(`?<Constant "NET SUCCESS!\\r\\n">` >> 8) & 0xff
   \   000074   12....       LCALL   ??printf?relay       ; Banked call to: printf
   \   000077   90....       MOV     DPTR,#SampleApp_NwkState
   \   00007A   E0           MOVX    A,@DPTR
   \   00007B   24FA         ADD     A,#-0x6
   \   00007D   7003         JNZ     $+5
   \   00007F   02....       LJMP    ??SampleApp_ProcessEvent_9 & 0xFFFF
   \   000082   14           DEC     A
   \   000083   6009         JZ      ??SampleApp_ProcessEvent_10
   \   000085   24FE         ADD     A,#-0x2
   \   000087   7003         JNZ     $+5
   \   000089   02....       LJMP    ??SampleApp_ProcessEvent_11 & 0xFFFF
   \   00008C   808C         SJMP    ??SampleApp_ProcessEvent_3
   \                     ??SampleApp_ProcessEvent_10:
   \   00008E                ; Setup parameters for call to function printf
   \   00008E   90....       MOV     DPTR,#_NIB + 33
   \   000091   12....       LCALL   ?PUSH_XSTACK8_X_TWO
   \   000094   12....       LCALL   ?Subroutine4 & 0xFFFF
   \                     ??CrossCallReturnLabel_3:
   \   000097   12....       LCALL   ?PUSH_XSTACK_I_TWO
   \   00009A   90....       MOV     DPTR,#_NIB + 23
   \   00009D   12....       LCALL   ?PUSH_XSTACK8_X_TWO
   \   0000A0   90....       MOV     DPTR,#_NIB + 20
   \   0000A3   12....       LCALL   ?PUSH_XSTACK8_X_TWO
   \   0000A6   7A..         MOV     R2,#`?<Constant "Router:0x%04X\\r\\nParent...">` & 0xff
   \   0000A8   7B..         MOV     R3,#(`?<Constant "Router:0x%04X\\r\\nParent...">` >> 8) & 0xff
   \                     ??SampleApp_ProcessEvent_12:
   \   0000AA   12....       LCALL   ??printf?relay       ; Banked call to: printf
   \   0000AD   7408         MOV     A,#0x8
   \   0000AF   12....       LCALL   ?DEALLOC_XSTACK8
   \   0000B2                ; Setup parameters for call to function printf
   \   0000B2   12....       LCALL   ?Subroutine3 & 0xFFFF
   \                     ??CrossCallReturnLabel_33:
   \   0000B5   12....       LCALL   ?PUSH_XSTACK_I_TWO
   \   0000B8   90....       MOV     DPTR,#aExtendedAddress + 1
   \   0000BB   12....       LCALL   ??Subroutine8_0 & 0xFFFF
   \                     ??CrossCallReturnLabel_11:
   \   0000BE   12....       LCALL   ?PUSH_XSTACK_I_TWO
   \   0000C1   90....       MOV     DPTR,#aExtendedAddress + 2
   \   0000C4   12....       LCALL   ??Subroutine8_0 & 0xFFFF
   \                     ??CrossCallReturnLabel_12:
   \   0000C7   12....       LCALL   ?PUSH_XSTACK_I_TWO
   \   0000CA   90....       MOV     DPTR,#aExtendedAddress + 3
   \   0000CD   12....       LCALL   ??Subroutine8_0 & 0xFFFF
   \                     ??CrossCallReturnLabel_13:
   \   0000D0   12....       LCALL   ?PUSH_XSTACK_I_TWO
   \   0000D3   90....       MOV     DPTR,#aExtendedAddress + 4
   \   0000D6   12....       LCALL   ??Subroutine8_0 & 0xFFFF
   \                     ??CrossCallReturnLabel_14:
   \   0000D9   12....       LCALL   ?PUSH_XSTACK_I_TWO
   \   0000DC   90....       MOV     DPTR,#aExtendedAddress + 5
   \   0000DF   12....       LCALL   ??Subroutine8_0 & 0xFFFF
   \                     ??CrossCallReturnLabel_15:
   \   0000E2   12....       LCALL   ?PUSH_XSTACK_I_TWO
   \   0000E5   90....       MOV     DPTR,#aExtendedAddress + 6
   \   0000E8   12....       LCALL   ??Subroutine8_0 & 0xFFFF
   \                     ??CrossCallReturnLabel_16:
   \   0000EB   12....       LCALL   ?PUSH_XSTACK_I_TWO
   \   0000EE   90....       MOV     DPTR,#aExtendedAddress + 7
   \   0000F1   12....       LCALL   ??Subroutine8_0 & 0xFFFF
   \                     ??CrossCallReturnLabel_17:
   \   0000F4   12....       LCALL   ?PUSH_XSTACK_I_TWO
   \   0000F7   7A..         MOV     R2,#`?<Constant "IEEE:%02X%02X%02X%02X...">` & 0xff
   \   0000F9   7B..         MOV     R3,#(`?<Constant "IEEE:%02X%02X%02X%02X...">` >> 8) & 0xff
   \   0000FB   12....       LCALL   ??printf?relay       ; Banked call to: printf
   \   0000FE   7410         MOV     A,#0x10
   \   000100   12....       LCALL   ?DEALLOC_XSTACK8
   \   000103                ; Setup parameters for call to function printf
   \   000103   90....       MOV     DPTR,#_NIB + 25
   \   000106   12....       LCALL   ??Subroutine8_0 & 0xFFFF
   \                     ??CrossCallReturnLabel_18:
   \   000109   12....       LCALL   ?PUSH_XSTACK_I_TWO
   \   00010C   90....       MOV     DPTR,#_NIB + 26
   \   00010F   12....       LCALL   ??Subroutine8_0 & 0xFFFF
   \                     ??CrossCallReturnLabel_19:
   \   000112   12....       LCALL   ?PUSH_XSTACK_I_TWO
   \   000115   90....       MOV     DPTR,#_NIB + 27
   \   000118   12....       LCALL   ??Subroutine8_0 & 0xFFFF
   \                     ??CrossCallReturnLabel_20:
   \   00011B   12....       LCALL   ?PUSH_XSTACK_I_TWO
   \   00011E   90....       MOV     DPTR,#_NIB + 28
   \   000121   12....       LCALL   ??Subroutine8_0 & 0xFFFF
   \                     ??CrossCallReturnLabel_21:
   \   000124   12....       LCALL   ?PUSH_XSTACK_I_TWO
   \   000127   90....       MOV     DPTR,#_NIB + 29
   \   00012A   12....       LCALL   ??Subroutine8_0 & 0xFFFF
   \                     ??CrossCallReturnLabel_22:
   \   00012D   12....       LCALL   ?PUSH_XSTACK_I_TWO
   \   000130   90....       MOV     DPTR,#_NIB + 30
   \   000133   12....       LCALL   ??Subroutine8_0 & 0xFFFF
   \                     ??CrossCallReturnLabel_23:
   \   000136   12....       LCALL   ?PUSH_XSTACK_I_TWO
   \   000139   90....       MOV     DPTR,#_NIB + 31
   \   00013C   12....       LCALL   ??Subroutine8_0 & 0xFFFF
   \                     ??CrossCallReturnLabel_24:
   \   00013F   12....       LCALL   ?PUSH_XSTACK_I_TWO
   \   000142   90....       MOV     DPTR,#_NIB + 32
   \   000145   12....       LCALL   ??Subroutine8_0 & 0xFFFF
   \                     ??CrossCallReturnLabel_25:
   \   000148   12....       LCALL   ?PUSH_XSTACK_I_TWO
   \   00014B   7A..         MOV     R2,#`?<Constant "Parent IEEE:%02X%02X%...">` & 0xff
   \   00014D   7B..         MOV     R3,#(`?<Constant "Parent IEEE:%02X%02X%...">` >> 8) & 0xff
   \                     ??SampleApp_ProcessEvent_13:
   \   00014F   12....       LCALL   ??printf?relay       ; Banked call to: printf
   \   000152   7410         MOV     A,#0x10
   \   000154   12....       LCALL   ?DEALLOC_XSTACK8
   \   000157   02....       LJMP    ??SampleApp_ProcessEvent_3 & 0xFFFF
   \                     ??SampleApp_ProcessEvent_9:
   \   00015A                ; Setup parameters for call to function printf
   \   00015A   90....       MOV     DPTR,#_NIB + 33
   \   00015D   12....       LCALL   ?PUSH_XSTACK8_X_TWO
   \   000160   12....       LCALL   ?Subroutine4 & 0xFFFF
   \                     ??CrossCallReturnLabel_4:
   \   000163   12....       LCALL   ?PUSH_XSTACK_I_TWO
   \   000166   90....       MOV     DPTR,#_NIB + 23
   \   000169   12....       LCALL   ?PUSH_XSTACK8_X_TWO
   \   00016C   90....       MOV     DPTR,#_NIB + 20
   \   00016F   12....       LCALL   ?PUSH_XSTACK8_X_TWO
   \   000172   7A..         MOV     R2,#`?<Constant "EndDevice:0x%04X\\r\\nPar...">` & 0xff
   \   000174   7B..         MOV     R3,#(`?<Constant "EndDevice:0x%04X\\r\\nPar...">` >> 8) & 0xff
   \   000176   02....       LJMP    ??SampleApp_ProcessEvent_12 & 0xFFFF
   \                     ??SampleApp_ProcessEvent_11:
   \   000179                ; Setup parameters for call to function printf
   \   000179   90....       MOV     DPTR,#_NIB + 33
   \   00017C   12....       LCALL   ?PUSH_XSTACK8_X_TWO
   \   00017F   12....       LCALL   ?Subroutine4 & 0xFFFF
   \                     ??CrossCallReturnLabel_5:
   \   000182   12....       LCALL   ?PUSH_XSTACK_I_TWO
   \   000185   90....       MOV     DPTR,#_NIB + 20
   \   000188   12....       LCALL   ?PUSH_XSTACK8_X_TWO
   \   00018B   7A..         MOV     R2,#`?<Constant "Coordinator:0x%04X\\r\\nC...">` & 0xff
   \   00018D   7B..         MOV     R3,#(`?<Constant "Coordinator:0x%04X\\r\\nC...">` >> 8) & 0xff
   \   00018F   12....       LCALL   ??printf?relay       ; Banked call to: printf
   \   000192   7406         MOV     A,#0x6
   \   000194   12....       LCALL   ?DEALLOC_XSTACK8
   \   000197                ; Setup parameters for call to function printf
   \   000197   12....       LCALL   ?Subroutine3 & 0xFFFF
    474              }
   \                     ??CrossCallReturnLabel_34:
   \   00019A   12....       LCALL   ?PUSH_XSTACK_I_TWO
   \   00019D   90....       MOV     DPTR,#aExtendedAddress + 1
   \   0001A0   12....       LCALL   ??Subroutine8_0 & 0xFFFF
   \                     ??CrossCallReturnLabel_26:
   \   0001A3   12....       LCALL   ?PUSH_XSTACK_I_TWO
   \   0001A6   90....       MOV     DPTR,#aExtendedAddress + 2
   \   0001A9   12....       LCALL   ??Subroutine8_0 & 0xFFFF
   \                     ??CrossCallReturnLabel_27:
   \   0001AC   12....       LCALL   ?PUSH_XSTACK_I_TWO
   \   0001AF   90....       MOV     DPTR,#aExtendedAddress + 3
   \   0001B2   12....       LCALL   ??Subroutine8_0 & 0xFFFF
   \                     ??CrossCallReturnLabel_28:
   \   0001B5   12....       LCALL   ?PUSH_XSTACK_I_TWO
   \   0001B8   90....       MOV     DPTR,#aExtendedAddress + 4
   \   0001BB   12....       LCALL   ??Subroutine8_0 & 0xFFFF
   \                     ??CrossCallReturnLabel_29:
   \   0001BE   12....       LCALL   ?PUSH_XSTACK_I_TWO
   \   0001C1   90....       MOV     DPTR,#aExtendedAddress + 5
   \   0001C4   12....       LCALL   ??Subroutine8_0 & 0xFFFF
   \                     ??CrossCallReturnLabel_30:
   \   0001C7   12....       LCALL   ?PUSH_XSTACK_I_TWO
   \   0001CA   90....       MOV     DPTR,#aExtendedAddress + 6
   \   0001CD   12....       LCALL   ??Subroutine8_0 & 0xFFFF
   \                     ??CrossCallReturnLabel_31:
   \   0001D0   12....       LCALL   ?PUSH_XSTACK_I_TWO
   \   0001D3   90....       MOV     DPTR,#aExtendedAddress + 7
   \   0001D6   12....       LCALL   ??Subroutine8_0 & 0xFFFF
   \                     ??CrossCallReturnLabel_32:
   \   0001D9   12....       LCALL   ?PUSH_XSTACK_I_TWO
   \   0001DC   7A..         MOV     R2,#`?<Constant "IEEE:%02X%02X%02X%02X...">` & 0xff
   \   0001DE   7B..         MOV     R3,#(`?<Constant "IEEE:%02X%02X%02X%02X...">` >> 8) & 0xff
   \   0001E0   02....       LJMP    ??SampleApp_ProcessEvent_13 & 0xFFFF
    475          
    476              // return unprocessed events
    477              return (events ^ SYS_EVENT_MSG);
   \                     ??SampleApp_ProcessEvent_4:
   \   0001E3   AA..         MOV     R2,?V0
   \   0001E5   E5..         MOV     A,?V1
   \   0001E7   6480         XRL     A,#0x80
   \   0001E9   FB           MOV     R3,A
   \   0001EA   8027         SJMP    ??SampleApp_ProcessEvent_14
    478            }
    479          
    480            // Send a message out - This event is generated by a timer
    481            //  (setup in SampleApp_Init()).
    482            /* AD采样事件处理，终端传感器数据采集和发送往协调器 */
    483            if ( events & SAMPLEAPP_ADC_MEA_EVT )
   \                     ??SampleApp_ProcessEvent_0:
   \   0001EC   EA           MOV     A,R2
   \   0001ED   5404         ANL     A,#0x4
   \   0001EF   6005         JZ      ??SampleApp_ProcessEvent_15
    484            {
    485              int numbers;
                         ^
Warning[Pe177]: variable "numbers" was declared but never referenced
    486              static uint16 res_std;
                                   ^
Warning[Pe177]: variable "res_std" was declared but never referenced
    487              uint16 res_t0,res_u,res_gh;
                            ^
Warning[Pe177]: variable "res_t0" was declared but never referenced

      uint16 res_t0,res_u,res_gh;
                    ^
"D:\简宝山\寿县17-09-01 25\程序\无线节点程序\code\Projects\zstack\Samples\SampleApp\Source\SampleApp.c",487  Warning[Pe177]: 
          variable "res_u" was declared but never referenced

      uint16 res_t0,res_u,res_gh;
                          ^
"D:\简宝山\寿县17-09-01 25\程序\无线节点程序\code\Projects\zstack\Samples\SampleApp\Source\SampleApp.c",487  Warning[Pe177]: 
          variable "res_gh" was declared but never referenced
    488              float temp;
                           ^
Warning[Pe177]: variable "temp" was declared but never referenced
    489              
    490              
    491           #if !(defined (ZDO_COORDINATOR)) && !(defined (RTR_NWK)) //终端
    492              /* 终端数据采集处理 */
    493              switch(adc_state)
    494              {
    495                case START: //开始测量
    496                      ADC_MeasureStart(STDR_CHANNEL, 0, 3, TRUE); //标准电阻AD转换开始    
    497                      adc_state = READY1; //进入下一状态
    498                      osal_start_timerEx( SampleApp_TaskID, SAMPLEAPP_ADC_MEA_EVT,SAMPLEAPP_ADC_MEA_TIMEOUT ); //200ms定时器事件，用于等待ADC转换完成
    499                      break;
    500                      
    501                case READY1: //标准电阻AD采样值读取，开启温度ADC转换
    502                      res_std = ADC_ReadData(0);
    503                      ADC_MeasureStart(T0_CHANNEL, 0, 3, TRUE); //温度AD转换开始             
    504                      adc_state = READY2; //进入下一状态
    505                      osal_start_timerEx( SampleApp_TaskID, SAMPLEAPP_ADC_MEA_EVT,SAMPLEAPP_ADC_MEA_TIMEOUT ); //200ms定时器事件，用于等待ADC转换完成
    506                      break;
    507                      
    508                case READY2: //温度AD采样值读取，开启湿度ADC转换
    509                      res_t0 = ADC_ReadData(0);
    510                      ADC_MeasureStart(U_CHANNEL, 0, 0, TRUE); //湿度AD转换开始
    511                      
    512                      if(res_std==0) //防止除数为零
    513                      {
    514                        res_std = 1;
    515                      }            
    516                      temp = (float)res_t0/(float)res_std*100;
    517                      temp = CalculateTemp(temp) + cal_t0 + CAL_T0_CONSTANT; //加上温度校准值
    518                      
    519                      temp = temp*10; //放大十倍，四舍五入
    520                      if(temp<0)
    521                      {
    522                        temp -= 0.5; 
    523                      }
    524                      else
    525                      {
    526                        temp += 0.5;
    527                      }
    528                       
    529                      sensor.temperature = temp;
    530                      
    531                      if(debug)
    532                      {
    533                        printf("\r\nres_std=%u,res_t0=%u,temper=%5.2f\r\n", res_std, res_t0, temp/10);
    534                      }
    535                      
    536                      adc_state = READY3; //进入下一状态
    537                      osal_start_timerEx( SampleApp_TaskID, SAMPLEAPP_ADC_MEA_EVT,SAMPLEAPP_ADC_MEA_TIMEOUT ); //200ms定时器事件，用于等待ADC转换完成
    538                      break;
    539                      
    540                case READY3: //湿度AD采样值读取，开启光合量ADC转换
    541                      res_u = ADC_ReadData(0);
    542                      ADC_MeasureStart(GH_CHANNEL, 0, 3, TRUE); //光合量AD转换开始 ，增益8倍          
    543                      sensor.humidity = (float)res_u/65535*AD_VREF*100 + 0.5;
    544                      
    545                      if(debug)
    546                      {
    547                        printf("\r\nres_u=%u,humidity=%d\r\n", res_u, sensor.humidity);
    548                      }
    549                      
    550                      adc_state = READY4; //进入下一状态
    551                      osal_start_timerEx( SampleApp_TaskID, SAMPLEAPP_ADC_MEA_EVT,SAMPLEAPP_ADC_MEA_TIMEOUT ); //200ms定时器事件，用于等待ADC转换完成
    552                      break;
    553                      
    554                case READY4: //光合量AD采样值读取，转换完成
    555                      res_gh = ADC_ReadData(0);
    556                      temp = (float)res_gh/65535*AD_VREF/8*1000; //乘1000电压单位转换为mV
    557                      sensor.photosyn = CalculateRadiation(temp, gh_factor) + 0.5 + CAL_GH; //加上光合整体订正值
    558                      if(debug)
    559                      {
    560                        printf("\r\nres_gh=%u,guanghe=%d\r\n", res_gh, sensor.photosyn);
    561                      }
    562                      adc_done = TRUE;
    563                      break;
    564              }
    565              
    566              if(adc_done) //测量转换完成，数据处理发送
    567              {
    568                    
    569                adc_state = START; //初始化
    570                
    571                adc_done = FALSE; //清零，为下次转换做准备
    572                
    573                numbers = sprintf(data_sensor, "BG,ID%03u,%04d,%03d,%04d,ED\r\n", sensor_id, 
    574                                  sensor.temperature, sensor.humidity, sensor.photosyn);
    575                
    576                /* 终端数据发送 */
    577                if(debug)
    578                {
    579                  printf("\r\n%s", data_sensor);
    580                }
    581                
    582                SampleApp_SendPointToPointMessage(data_sensor, numbers); //点对点发送函数,终端传感器数据发往协调器
    583              }
    584          #endif
    585          
    586              // return unprocessed events
    587              return (events ^ SAMPLEAPP_ADC_MEA_EVT);
   \   0001F1   EA           MOV     A,R2
   \   0001F2   6404         XRL     A,#0x4
   \   0001F4   8007         SJMP    ??SampleApp_ProcessEvent_16
    588            }
    589            
    590            /* 周期 5s 事件处理 */
    591            if( events & SAMPLEAPP_SEND_PERIODIC_MSG_EVT )
   \                     ??SampleApp_ProcessEvent_15:
   \   0001F6   EA           MOV     A,R2
   \   0001F7   A2E0         MOV     C,0xE0 /* A   */.0
   \   0001F9   5005         JNC     ??SampleApp_ProcessEvent_17
    592            {
    593          #if !(defined (ZDO_COORDINATOR)) && !(defined (RTR_NWK)) //终端
    594              osal_set_event( SampleApp_TaskID, SAMPLEAPP_ADC_MEA_EVT );//触发ADC采样处理事件
    595          #endif
    596              // return unprocessed events
    597              return (events ^ SAMPLEAPP_SEND_PERIODIC_MSG_EVT);
   \   0001FB   6401         XRL     A,#0x1
   \                     ??SampleApp_ProcessEvent_16:
   \   0001FD   FA           MOV     R2,A
   \   0001FE   8013         SJMP    ??SampleApp_ProcessEvent_14
    598            }
    599            
    600            /* 周期500ms喂狗事件处理 */
    601            if( events & SAMPLEAPP_WDT_PERIODIC_MSG_EVT )
   \                     ??SampleApp_ProcessEvent_17:
   \   000200   5402         ANL     A,#0x2
   \   000202   600B         JZ      ??SampleApp_ProcessEvent_18
    602            {
    603              if(!rs_flag)
   \   000204   90....       MOV     DPTR,#rs_flag
   \   000207   12....       LCALL   ?Subroutine6 & 0xFFFF
   \                     ??CrossCallReturnLabel_8:
   \   00020A   7003         JNZ     ??SampleApp_ProcessEvent_18
    604              {
    605                WDT_Feed();//喂狗
   \   00020C                ; Setup parameters for call to function WDT_Feed
   \   00020C   12....       LCALL   ??WDT_Feed?relay     ; Banked call to: WDT_Feed
    606                //HalUARTWrite(0,"hellow!\n",strlen("hellow!\n") );
    607              }
    608            }
    609          
    610            // Discard unknown events
    611            return 0;
   \                     ??SampleApp_ProcessEvent_18:
   \   00020F   7A00         MOV     R2,#0x0
   \   000211   7B00         MOV     R3,#0x0
   \                     ??SampleApp_ProcessEvent_14:
   \   000213   7F04         MOV     R7,#0x4
   \   000215   02....       LJMP    ?BANKED_LEAVE_XDATA
    612          }

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   \                     ?Subroutine4:
   \   000000   90....       MOV     DPTR,#_NIB + 22
   \   000003   E0           MOVX    A,@DPTR
   \   000004   F5..         MOV     ?V2,A
   \   000006   75..00       MOV     ?V3,#0x0
   \   000009   78..         MOV     R0,#?V2
   \   00000B   22           RET

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   \                     ?Subroutine3:
   \   000000   90....       MOV     DPTR,#aExtendedAddress
   \   000003                REQUIRE ??Subroutine8_0
   \   000003                ; // Fall through to label ??Subroutine8_0

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   \                     ??Subroutine8_0:
   \   000000   E0           MOVX    A,@DPTR
   \   000001   F5..         MOV     ?V2,A
   \   000003   78..         MOV     R0,#?V2
   \   000005   22           RET

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   \                     ?Subroutine6:
   \   000000   E0           MOVX    A,@DPTR
   \   000001   F8           MOV     R0,A
   \   000002   A3           INC     DPTR
   \   000003   E0           MOVX    A,@DPTR
   \   000004   F9           MOV     R1,A
   \   000005   E8           MOV     A,R0
   \   000006   49           ORL     A,R1
   \   000007   22           RET
    613          
    614          /*********************************************************************
    615           * Event Generation Functions
    616           */
    617          
    618          
    619          /*********************************************************************
    620           * LOCAL FUNCTIONS
    621           */
    622          
    623          /*********************************************************************
    624           * @fn      SampleApp_MessageMSGCB
    625           *
    626           * @brief   这个函数管理所有接受到的数据，至于数据来自哪个设备，它是根据
    627           *          簇ID来分辨的。
    628           *          所有接收到的数据都会存入 afIncomingMSGPacket_t *pkt所指向的存储区域
    629           *          内
    630           *          
    631           *          
    632           *
    633           * @param   none
    634           *
    635           * @return  none
    636           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
    637          void SampleApp_MessageMSGCB( afIncomingMSGPacket_t *pkt ) //2017.03.17 杨广湘：去除簇ID方式解析信息，
   \                     SampleApp_MessageMSGCB:
    638          {
   \   000000                REQUIRE ?V0
   \   000000                REQUIRE ?V1
   \   000000   74F6         MOV     A,#-0xa
   \   000002   12....       LCALL   ?BANKED_ENTER_XDATA
   \   000005                ; Saved register size: 10
   \   000005                ; Auto size: 0
    639            char *str = &pkt->cmd.Data[0];
                               ^
Warning[Pe144]: a value of type "unsigned char *" cannot be used to initialize
          an entity of type "char *"
   \   000005   EA           MOV     A,R2
   \   000006   2422         ADD     A,#0x22
   \   000008   F582         MOV     DPL,A
   \   00000A   E4           CLR     A
   \   00000B   3B           ADDC    A,R3
   \   00000C   F583         MOV     DPH,A
   \   00000E   E0           MOVX    A,@DPTR
   \   00000F   FE           MOV     R6,A
   \   000010   A3           INC     DPTR
   \   000011   E0           MOVX    A,@DPTR
   \   000012   FF           MOV     R7,A
    640            int len = pkt->cmd.DataLength;
   \   000013   EA           MOV     A,R2
   \   000014   2420         ADD     A,#0x20
   \   000016   F582         MOV     DPL,A
   \   000018   E4           CLR     A
   \   000019   3B           ADDC    A,R3
   \   00001A   F583         MOV     DPH,A
   \   00001C   E0           MOVX    A,@DPTR
   \   00001D   F5..         MOV     ?V0,A
   \   00001F   A3           INC     DPTR
   \   000020   E0           MOVX    A,@DPTR
   \   000021   F5..         MOV     ?V1,A
    641            int sens_id = 0;
    642            char temp[20];
    643            int numbers;
    644            
    645            /* 无线接收数据打印 */
    646            if(debug) //调试信息
   \   000023   90....       MOV     DPTR,#debug
   \   000026   12....       LCALL   ?Subroutine6 & 0xFFFF
   \                     ??CrossCallReturnLabel_9:
   \   000029   600D         JZ      ??SampleApp_MessageMSGCB_0
    647            {
    648              HalUARTWrite(0, str,len);//打印收到数据
                                     ^
Warning[Pe167]: argument of type "char *" is incompatible with parameter of
          type "unsigned char *"

    char temp[20];
         ^
"D:\简宝山\寿县17-09-01 25\程序\无线节点程序\code\Projects\zstack\Samples\SampleApp\Source\SampleApp.c",642  Warning[Pe177]: 
          variable "temp" was declared but never referenced

    int numbers;
        ^
"D:\简宝山\寿县17-09-01 25\程序\无线节点程序\code\Projects\zstack\Samples\SampleApp\Source\SampleApp.c",643  Warning[Pe177]: 
          variable "numbers" was declared but never referenced
   \   00002B                ; Setup parameters for call to function HalUARTWrite
   \   00002B   AC..         MOV     R4,?V0
   \   00002D   AD..         MOV     R5,?V1
   \   00002F   EE           MOV     A,R6
   \   000030   FA           MOV     R2,A
   \   000031   EF           MOV     A,R7
   \   000032   FB           MOV     R3,A
   \   000033   7900         MOV     R1,#0x0
   \   000035   12....       LCALL   ??HalUARTWrite?relay ; Banked call to: HalUARTWrite
    649            }
    650            
    651            /* 无线接收数据解析 */
    652            if(*(str+len-1)== '\n')
   \                     ??SampleApp_MessageMSGCB_0:
   \   000038   EE           MOV     A,R6
   \   000039   25..         ADD     A,?V0
   \   00003B   F8           MOV     R0,A
   \   00003C   EF           MOV     A,R7
   \   00003D   35..         ADDC    A,?V1
   \   00003F   12....       LCALL   ?Subroutine5 & 0xFFFF
   \                     ??CrossCallReturnLabel_6:
   \   000042   6003         JZ      $+5
   \   000044   02....       LJMP    ??SampleApp_MessageMSGCB_1 & 0xFFFF
    653            {
    654          #if defined (ZDO_COORDINATOR) || defined (RTR_NWK) //协调器
    655              /* 协调器接收数据解析 */
    656              sens_id = atoi(str+DATA_OFFSET_ID);
   \   000047                ; Setup parameters for call to function atoi
   \   000047   EE           MOV     A,R6
   \   000048   2405         ADD     A,#0x5
   \   00004A   FA           MOV     R2,A
   \   00004B   E4           CLR     A
   \   00004C   3F           ADDC    A,R7
   \   00004D   FB           MOV     R3,A
   \   00004E   12....       LCALL   ??atoi?relay         ; Banked call to: atoi
   \   000051   8A..         MOV     ?V0,R2
   \   000053   8B..         MOV     ?V1,R3
   \   000055   A8..         MOV     R0,?V0
   \   000057   A9..         MOV     R1,?V1
    657              if(sens_id>=1&&sens_id<=3) //提取传感器数据
   \   000059   E8           MOV     A,R0
   \   00005A   24FF         ADD     A,#-0x1
   \   00005C   1A           DEC     R2
   \   00005D   E9           MOV     A,R1
   \   00005E   34FF         ADDC    A,#-0x1
   \   000060   FB           MOV     R3,A
   \   000061   C3           CLR     C
   \   000062   EA           MOV     A,R2
   \   000063   9403         SUBB    A,#0x3
   \   000065   EB           MOV     A,R3
   \   000066   9400         SUBB    A,#0x0
   \   000068   5068         JNC     ??SampleApp_MessageMSGCB_1
    658              {
    659                int i = 0;
    660                i = sens_id - 1;
   \   00006A   E8           MOV     A,R0
   \   00006B   24FF         ADD     A,#-0x1
   \   00006D   18           DEC     R0
   \   00006E   E9           MOV     A,R1
   \   00006F   34FF         ADDC    A,#-0x1
   \   000071   F9           MOV     R1,A
    661                coordi[i].temperature = atoi(str+DATA_OFFSET_T0);
   \   000072   E8           MOV     A,R0
   \   000073   75F006       MOV     B,#0x6
   \   000076   A4           MUL     AB
   \   000077   F8           MOV     R0,A
   \   000078   AAF0         MOV     R2,B
   \   00007A   75F006       MOV     B,#0x6
   \   00007D   E9           MOV     A,R1
   \   00007E   A4           MUL     AB
   \   00007F   2A           ADD     A,R2
   \   000080   F9           MOV     R1,A
   \   000081   74..         MOV     A,#coordi & 0xff
   \   000083   28           ADD     A,R0
   \   000084   F8           MOV     R0,A
   \   000085   74..         MOV     A,#(coordi >> 8) & 0xff
   \   000087   39           ADDC    A,R1
   \   000088   F9           MOV     R1,A
   \   000089   88..         MOV     ?V0,R0
   \   00008B   89..         MOV     ?V1,R1
   \   00008D                ; Setup parameters for call to function atoi
   \   00008D   EE           MOV     A,R6
   \   00008E   2409         ADD     A,#0x9
   \   000090   FA           MOV     R2,A
   \   000091   E4           CLR     A
   \   000092   3F           ADDC    A,R7
   \   000093   FB           MOV     R3,A
   \   000094   12....       LCALL   ??atoi?relay         ; Banked call to: atoi
   \   000097   85..82       MOV     DPL,?V0
   \   00009A   85..83       MOV     DPH,?V1
   \   00009D   EA           MOV     A,R2
   \   00009E   F0           MOVX    @DPTR,A
   \   00009F   A3           INC     DPTR
   \   0000A0   EB           MOV     A,R3
   \   0000A1   F0           MOVX    @DPTR,A
    662                coordi[i].humidity = atoi(str+DATA_OFFSET_U);
   \   0000A2                ; Setup parameters for call to function atoi
   \   0000A2   EE           MOV     A,R6
   \   0000A3   240E         ADD     A,#0xe
   \   0000A5   FA           MOV     R2,A
   \   0000A6   E4           CLR     A
   \   0000A7   3F           ADDC    A,R7
   \   0000A8   FB           MOV     R3,A
   \   0000A9   12....       LCALL   ??atoi?relay         ; Banked call to: atoi
   \   0000AC   85..82       MOV     DPL,?V0
   \   0000AF   85..83       MOV     DPH,?V1
   \   0000B2   A3           INC     DPTR
   \   0000B3   A3           INC     DPTR
   \   0000B4   EA           MOV     A,R2
   \   0000B5   F0           MOVX    @DPTR,A
   \   0000B6   A3           INC     DPTR
   \   0000B7   EB           MOV     A,R3
   \   0000B8   F0           MOVX    @DPTR,A
    663                coordi[i].photosyn = atoi(str+DATA_OFFSET_GH);
   \   0000B9                ; Setup parameters for call to function atoi
   \   0000B9   EE           MOV     A,R6
   \   0000BA   2412         ADD     A,#0x12
   \   0000BC   FA           MOV     R2,A
   \   0000BD   E4           CLR     A
   \   0000BE   3F           ADDC    A,R7
   \   0000BF   FB           MOV     R3,A
   \   0000C0   12....       LCALL   ??atoi?relay         ; Banked call to: atoi
   \   0000C3   85..82       MOV     DPL,?V0
   \   0000C6   85..83       MOV     DPH,?V1
   \   0000C9   A3           INC     DPTR
   \   0000CA   A3           INC     DPTR
   \   0000CB   A3           INC     DPTR
   \   0000CC   A3           INC     DPTR
   \   0000CD   EA           MOV     A,R2
   \   0000CE   F0           MOVX    @DPTR,A
   \   0000CF   A3           INC     DPTR
   \   0000D0   EB           MOV     A,R3
   \   0000D1   F0           MOVX    @DPTR,A
    664              }
    665              
    666          #else //终端
    667              /* 终端接收数据解析 */
    668              if(osal_memcmp(str,"#RS",3))//复位
    669              {
    670                if((len>5)&&(atoi(str+4)!=0))  //参数不为0清除掉网络信息
    671                {
    672                  zgWriteStartupOptions(ZG_STARTUP_SET, ZCD_STARTOPT_DEFAULT_NETWORK_STATE);
    673                  printf("clear\r\n");
    674                }
    675                
    676                printf("reset\r\n");
    677                /* 复位 */     
    678                rs_flag = 1;//置位停止喂狗标志     
    679              }
    680              else if(osal_memcmp(str,"#GH",3))
    681              {
    682                if(len == 5) //读取光合表系数
    683                {
    684                  numbers = sprintf(temp,"<GH,%03u,%.2f>\r\n", sensor_id, gh_factor);
    685                  SampleApp_SendPointToPointMessage(temp, numbers);
    686                }
    687                else //设置光合表系数
    688                {
    689                  float temp_gh;
    690                  int temp_id;
    691                  char *p = NULL;
    692                  
    693                  p = strchr(str, ','); //查找第一个","出现的位置
    694                  sscanf(p+1, "%d", &temp_id);
    695                  if(temp_id == sensor_id)
    696                  {
    697                    p = strchr(p+1, ','); //查找第二个","出现的位置
    698                    sscanf(p+1, "%f", &temp_gh);
    699                    if(temp_gh>=1.0)
    700                    {
    701                      gh_factor = temp_gh;
    702                      
    703                      /* 光合表系数存入flash */
    704                      sprintf(dev_gh, "%5.2f", gh_factor);
    705                      
    706                      if(SUCCESS == osal_nv_write(DEVICE_GH, 0, DEVICE_GH_LEN, dev_gh))
    707                        ReturnTorF(1,0); //存入成功
    708                      else
    709                        ReturnTorF(0,0); //存入失败
    710                    }
    711                    else
    712                    {
    713                      ReturnTorF(0,0); //错误
    714                    }
    715                  }
    716                }
    717              }
    718          #endif
    719            }
    720          
    721          }
   \                     ??SampleApp_MessageMSGCB_1:
   \   0000D2   80..         SJMP    ??Subroutine9_0

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   \                     ??Subroutine9_0:
   \   000000   7F02         MOV     R7,#0x2
   \   000002   02....       LJMP    ?BANKED_LEAVE_XDATA

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   \                     ?Subroutine5:
   \   000000   F9           MOV     R1,A
   \   000001   E8           MOV     A,R0
   \   000002   24FF         ADD     A,#-0x1
   \   000004   F582         MOV     DPL,A
   \   000006   E9           MOV     A,R1
   \   000007   34FF         ADDC    A,#-0x1
   \   000009   F583         MOV     DPH,A
   \   00000B   E0           MOVX    A,@DPTR
   \   00000C   640A         XRL     A,#0xa
   \   00000E   22           RET
    722          
    723          /*********************************************************************
    724           * @fn      SampleApp_SendPeriodicMessage
    725           *
    726           * @brief   Send the periodic message.
    727           *          这个函数，是一个周期性数据发送函数，它是设备设置为周期性广播的时候
    728           *          调用的，它是我们设置发送数据的地方
    729           *   SAMPLEAPP_PERIODIC_CLUSTERID,  这是一个簇，定义的作用是和接收方建立联系，
    730           *           协调器收到这个标号，如果是1，就是证明是由周期性广播方式发送过来的
    731           *
    732           * @param   none
    733           *
    734           * @return  none
    735           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
    736          void SampleApp_SendPeriodicMessage(char *p, int len)
   \                     SampleApp_SendPeriodicMessage:
    737          {
   \   000000                REQUIRE ?V0
   \   000000                REQUIRE ?V1
   \   000000   74F6         MOV     A,#-0xa
   \   000002   12....       LCALL   ?BANKED_ENTER_XDATA
   \   000005                ; Saved register size: 10
   \   000005                ; Auto size: 0
    738            if ( AF_DataRequest( &SampleApp_Periodic_DstAddr, &SampleApp_epDesc,
    739                                 SAMPLEAPP_PERIODIC_CLUSTERID,  
    740                                 len,//字节数
    741                                 p,//指针头
                                        ^
Warning[Pe167]: argument of type "char *" is incompatible with parameter of
          type "unsigned char *"
    742                                 &SampleApp_TransID,
    743                                 AF_DISCV_ROUTE,
    744                                 AF_DEFAULT_RADIUS ) == afStatus_SUCCESS )
   \   000005                ; Setup parameters for call to function AF_DataRequest
   \   000005   75..1E       MOV     ?V0,#0x1e
   \   000008   78..         MOV     R0,#?V0
   \   00000A   12....       LCALL   ?PUSH_XSTACK_I_ONE
   \   00000D   75....       MOV     ?V0,#SampleApp_TransID & 0xff
   \   000010   75....       MOV     ?V1,#(SampleApp_TransID >> 8) & 0xff
   \   000013   78..         MOV     R0,#?V0
   \   000015   12....       LCALL   ?PUSH_XSTACK_I_TWO
   \   000018   8A..         MOV     ?V0,R2
   \   00001A   8B..         MOV     ?V1,R3
   \   00001C   78..         MOV     R0,#?V0
   \   00001E   12....       LCALL   ?PUSH_XSTACK_I_TWO
   \   000021   8C..         MOV     ?V0,R4
   \   000023   8D..         MOV     ?V1,R5
   \   000025   78..         MOV     R0,#?V0
   \   000027   12....       LCALL   ?PUSH_XSTACK_I_TWO
   \   00002A   75..01       MOV     ?V0,#0x1
   \   00002D   75..00       MOV     ?V1,#0x0
   \   000030   78..         MOV     R0,#?V0
   \   000032   12....       LCALL   ?PUSH_XSTACK_I_TWO
   \   000035   7920         MOV     R1,#0x20
   \   000037   7C..         MOV     R4,#SampleApp_epDesc & 0xff
   \   000039   7D..         MOV     R5,#(SampleApp_epDesc >> 8) & 0xff
   \   00003B   7A..         MOV     R2,#SampleApp_Periodic_DstAddr & 0xff
   \   00003D   7B..         MOV     R3,#(SampleApp_Periodic_DstAddr >> 8) & 0xff
   \   00003F                REQUIRE ?Subroutine0
   \   00003F                ; // Fall through to label ?Subroutine0
    745            {
    746            }
    747            else
    748            {
    749              // Error occurred in request to send.
    750            }
    751          }

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   \                     ?Subroutine0:
   \   000000   12....       LCALL   ??AF_DataRequest?relay; Banked call to: AF_DataRequest
   \   000003   7409         MOV     A,#0x9
   \   000005   12....       LCALL   ?DEALLOC_XSTACK8
   \   000008                REQUIRE ??Subroutine9_0
   \   000008                ; // Fall through to label ??Subroutine9_0
    752          
    753          /*********************************************************************
    754           * @fn      SampleApp_SendPointToPointMessage
    755           *
    756           * @brief   网蜂点对点发送函数
    757           *
    758           * @param   none
    759           *
    760           * @return  none
    761           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
    762          void SampleApp_SendPointToPointMessage( char *p, int len )
   \                     SampleApp_SendPointToPointMessage:
    763          { 
   \   000000                REQUIRE ?V0
   \   000000                REQUIRE ?V1
   \   000000   74F6         MOV     A,#-0xa
   \   000002   12....       LCALL   ?BANKED_ENTER_XDATA
   \   000005                ; Saved register size: 10
   \   000005                ; Auto size: 0
    764            if ( AF_DataRequest( &Point_To_Point_DstAddr,&SampleApp_epDesc,
    765                                   SAMPLEAPP_POINT_TO_POINT_CLUSTERID,
    766                                   len,//字节数
    767                                   p,//首地址  要发送数据的首地址
                                          ^
Warning[Pe167]: argument of type "char *" is incompatible with parameter of
          type "unsigned char *"
    768                                   &SampleApp_TransID,
    769                                   AF_DISCV_ROUTE,
    770                                   AF_DEFAULT_RADIUS ) == afStatus_SUCCESS )
   \   000005                ; Setup parameters for call to function AF_DataRequest
   \   000005   75..1E       MOV     ?V0,#0x1e
   \   000008   78..         MOV     R0,#?V0
   \   00000A   12....       LCALL   ?PUSH_XSTACK_I_ONE
   \   00000D   75....       MOV     ?V0,#SampleApp_TransID & 0xff
   \   000010   75....       MOV     ?V1,#(SampleApp_TransID >> 8) & 0xff
   \   000013   78..         MOV     R0,#?V0
   \   000015   12....       LCALL   ?PUSH_XSTACK_I_TWO
   \   000018   8A..         MOV     ?V0,R2
   \   00001A   8B..         MOV     ?V1,R3
   \   00001C   78..         MOV     R0,#?V0
   \   00001E   12....       LCALL   ?PUSH_XSTACK_I_TWO
   \   000021   8C..         MOV     ?V0,R4
   \   000023   8D..         MOV     ?V1,R5
   \   000025   78..         MOV     R0,#?V0
   \   000027   12....       LCALL   ?PUSH_XSTACK_I_TWO
   \   00002A   75..03       MOV     ?V0,#0x3
   \   00002D   75..00       MOV     ?V1,#0x0
   \   000030   78..         MOV     R0,#?V0
   \   000032   12....       LCALL   ?PUSH_XSTACK_I_TWO
   \   000035   7920         MOV     R1,#0x20
   \   000037   7C..         MOV     R4,#SampleApp_epDesc & 0xff
   \   000039   7D..         MOV     R5,#(SampleApp_epDesc >> 8) & 0xff
   \   00003B   7A..         MOV     R2,#Point_To_Point_DstAddr & 0xff
   \   00003D   7B..         MOV     R3,#(Point_To_Point_DstAddr >> 8) & 0xff
   \   00003F   80..         SJMP    ?Subroutine0
    771            {
    772            }
    773            else
    774            {
    775              // Error occurred in request to send.
    776            }
    777          }
    778          
    779          /*********************************************************************
    780           * @fn      SampleApp_SerialCMD
    781           *
    782           * @brief   通讯串口接收数据解析
    783           *
    784           * @param   none
    785           *
    786           * @return  none
    787           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
    788          void SampleApp_SerialCMD(mtOSALSerialData_t *cmdMsg)
   \                     SampleApp_SerialCMD:
    789          {
   \   000000                REQUIRE ?V0
   \   000000                REQUIRE ?V1
   \   000000                REQUIRE ?V2
   \   000000                REQUIRE ?V3
   \   000000                REQUIRE ?V4
   \   000000                REQUIRE ?V5
   \   000000                REQUIRE ?V6
   \   000000   74F1         MOV     A,#-0xf
   \   000002   12....       LCALL   ?BANKED_ENTER_XDATA
   \   000005                ; Saved register size: 15
   \   000005                ; Auto size: 2
   \   000005   74FE         MOV     A,#-0x2
   \   000007   12....       LCALL   ?ALLOC_XSTACK8
    790             uint8 i,len,*str=NULL; //len 有用数据长度
    791             int numbers;
    792             str=cmdMsg->msg; //指向数据开头
   \   00000A   8A82         MOV     DPL,R2
   \   00000C   8B83         MOV     DPH,R3
   \   00000E   A3           INC     DPTR
   \   00000F   A3           INC     DPTR
   \   000010   E0           MOVX    A,@DPTR
   \   000011   FE           MOV     R6,A
   \   000012   A3           INC     DPTR
   \   000013   E0           MOVX    A,@DPTR
   \   000014   FF           MOV     R7,A
    793             len=*str; //msg 里的第 1 个字节代表后面的数据长度
   \   000015   8E82         MOV     DPL,R6
   \   000017   8F83         MOV     DPH,R7
   \   000019   E0           MOVX    A,@DPTR
   \   00001A   F5..         MOV     ?V0,A
    794             str++; //令指针指向第一个字符
   \   00001C   A3           INC     DPTR
   \   00001D   AE82         MOV     R6,DPL
   \   00001F   AF83         MOV     R7,DPH
    795             
    796             /********打印出串口接收到的数据，用于提示*********/
    797             //HalUARTWrite(0,str,len);
    798             
    799             /* 上位机指令解析 */
    800             if(*(str+len-1)== '\n')
   \   000021   F5..         MOV     ?V2,A
   \   000023   EE           MOV     A,R6
   \   000024   25..         ADD     A,?V2
   \   000026   F8           MOV     R0,A
   \   000027   E4           CLR     A
   \   000028   3F           ADDC    A,R7
   \   000029   12....       LCALL   ?Subroutine5 & 0xFFFF
   \                     ??CrossCallReturnLabel_7:
   \   00002C   6003         JZ      $+5
   \   00002E   02....       LJMP    ??SampleApp_SerialCMD_0 & 0xFFFF
    801             {
    802          #if defined (ZDO_COORDINATOR) || defined (RTR_NWK) //协调器
    803               
    804                //数据读取（DM）
    805                if(osal_memcmp(str,"#DM",3)) //主采读取数据
   \   000031                ; Setup parameters for call to function osal_memcmp
   \   000031   75....       MOV     ?V4,#`?<Constant "#DM">` & 0xff
   \   000034   75....       MOV     ?V5,#(`?<Constant "#DM">` >> 8) & 0xff
   \   000037   75..00       MOV     ?V6,#0x0
   \   00003A   78..         MOV     R0,#?V4
   \   00003C   12....       LCALL   ?PUSH_XSTACK_I_THREE
   \   00003F   7C03         MOV     R4,#0x3
   \   000041   7D00         MOV     R5,#0x0
   \   000043   8E82         MOV     DPL,R6
   \   000045   8F83         MOV     DPH,R7
   \   000047   A982         MOV     R1,DPL
   \   000049   AA83         MOV     R2,DPH
   \   00004B   7B00         MOV     R3,#0x0
   \   00004D   12....       LCALL   ??osal_memcmp?relay  ; Banked call to: osal_memcmp
   \   000050   7403         MOV     A,#0x3
   \   000052   12....       LCALL   ?DEALLOC_XSTACK8
   \   000055   E9           MOV     A,R1
   \   000056   6061         JZ      ??SampleApp_SerialCMD_1
    806                {
    807                  /* 主采读取数据 */
    808                  numbers = sprintf(data_coor, "BG,ID001,%04d,%03d,%04d,ID002,%04d,%03d,%04d,ID003,%04d,%03d,%04d,ED\r\n",coordi[0].temperature,
    809                                    coordi[0].humidity,coordi[0].photosyn,coordi[1].temperature,coordi[1].humidity,coordi[1].photosyn,
    810                                    coordi[2].temperature,coordi[2].humidity,coordi[2].photosyn); //数据填充
    811                  
    812                  SendDataToCollector(data_coor, numbers); //数据发往主采
   \   000058                ; Setup parameters for call to function SendDataToCollector
   \   000058                ; Setup parameters for call to function sprintf
   \   000058   90....       MOV     DPTR,#coordi + 16
   \   00005B   12....       LCALL   ?PUSH_XSTACK8_X_TWO
   \   00005E   90....       MOV     DPTR,#coordi + 14
   \   000061   12....       LCALL   ?PUSH_XSTACK8_X_TWO
   \   000064   90....       MOV     DPTR,#coordi + 12
   \   000067   12....       LCALL   ?PUSH_XSTACK8_X_TWO
   \   00006A   90....       MOV     DPTR,#coordi + 10
   \   00006D   12....       LCALL   ?PUSH_XSTACK8_X_TWO
   \   000070   90....       MOV     DPTR,#coordi + 8
   \   000073   12....       LCALL   ?PUSH_XSTACK8_X_TWO
   \   000076   90....       MOV     DPTR,#coordi + 6
   \   000079   12....       LCALL   ?PUSH_XSTACK8_X_TWO
   \   00007C   90....       MOV     DPTR,#coordi + 4
   \   00007F   12....       LCALL   ?PUSH_XSTACK8_X_TWO
   \   000082   90....       MOV     DPTR,#coordi + 2
   \   000085   12....       LCALL   ?PUSH_XSTACK8_X_TWO
   \   000088   90....       MOV     DPTR,#coordi
   \   00008B   12....       LCALL   ?PUSH_XSTACK8_X_TWO
   \   00008E   7C..         MOV     R4,#`?<Constant "BG,ID001,%04d,%03d,%0...">` & 0xff
   \   000090   7D..         MOV     R5,#(`?<Constant "BG,ID001,%04d,%03d,%0...">` >> 8) & 0xff
   \   000092   7A..         MOV     R2,#data_coor & 0xff
   \   000094   7B..         MOV     R3,#(data_coor >> 8) & 0xff
   \   000096   12....       LCALL   ??sprintf?relay      ; Banked call to: sprintf
   \   000099   7412         MOV     A,#0x12
   \   00009B   12....       LCALL   ?DEALLOC_XSTACK8
   \   00009E   EA           MOV     A,R2
   \   00009F   FC           MOV     R4,A
   \   0000A0   EB           MOV     A,R3
   \   0000A1   FD           MOV     R5,A
   \   0000A2   7A..         MOV     R2,#data_coor & 0xff
   \   0000A4   7B..         MOV     R3,#(data_coor >> 8) & 0xff
   \   0000A6   12....       LCALL   ??SendDataToCollector?relay; Banked call to: SendDataToCollector
    813                  
    814                  osal_memset(coordi, 0, sizeof(dataType_t)*3); //发送后数据清零
   \   0000A9                ; Setup parameters for call to function osal_memset
   \   0000A9   7C12         MOV     R4,#0x12
   \   0000AB   7D00         MOV     R5,#0x0
   \   0000AD   7900         MOV     R1,#0x0
   \   0000AF   7A..         MOV     R2,#coordi & 0xff
   \   0000B1   7B..         MOV     R3,#(coordi >> 8) & 0xff
   \   0000B3   12....       LCALL   ??osal_memset?relay  ; Banked call to: osal_memset
   \   0000B6   02....       LJMP    ??SampleApp_SerialCMD_2 & 0xFFFF
    815                }
    816                
    817                //复位指令（RS）
    818                else if(osal_memcmp(str,"#RS",3))
   \                     ??SampleApp_SerialCMD_1:
   \   0000B9                ; Setup parameters for call to function osal_memcmp
   \   0000B9   75....       MOV     ?V4,#`?<Constant "#RS">` & 0xff
   \   0000BC   75....       MOV     ?V5,#(`?<Constant "#RS">` >> 8) & 0xff
   \   0000BF   78..         MOV     R0,#?V4
   \   0000C1   12....       LCALL   ?PUSH_XSTACK_I_THREE
   \   0000C4   7C03         MOV     R4,#0x3
   \   0000C6   7D00         MOV     R5,#0x0
   \   0000C8   8E82         MOV     DPL,R6
   \   0000CA   8F83         MOV     DPH,R7
   \   0000CC   A982         MOV     R1,DPL
   \   0000CE   AA83         MOV     R2,DPH
   \   0000D0   7B00         MOV     R3,#0x0
   \   0000D2   12....       LCALL   ??osal_memcmp?relay  ; Banked call to: osal_memcmp
   \   0000D5   7403         MOV     A,#0x3
   \   0000D7   12....       LCALL   ?DEALLOC_XSTACK8
   \   0000DA   E9           MOV     A,R1
   \   0000DB   6044         JZ      ??SampleApp_SerialCMD_3
    819                {
    820                  /* 复位 */
    821                  if((len>5)&&(atoi(str+4)!=0))  //参数不为0清除掉网络信息
                                           ^
Warning[Pe167]: argument of type "unsigned char *" is incompatible with
          parameter of type "char const *"
   \   0000DD   E5..         MOV     A,?V0
   \   0000DF   C3           CLR     C
   \   0000E0   9406         SUBB    A,#0x6
   \   0000E2   401B         JC      ??SampleApp_SerialCMD_4
   \   0000E4                ; Setup parameters for call to function atoi
   \   0000E4   12....       LCALL   ??Subroutine10_0 & 0xFFFF
   \                     ??CrossCallReturnLabel_35:
   \   0000E7   12....       LCALL   ??atoi?relay         ; Banked call to: atoi
   \   0000EA   8B..         MOV     ?V3,R3
   \   0000EC   EA           MOV     A,R2
   \   0000ED   45..         ORL     A,?V3
   \   0000EF   600E         JZ      ??SampleApp_SerialCMD_4
    822                  {
    823                    zgWriteStartupOptions(ZG_STARTUP_SET, ZCD_STARTOPT_DEFAULT_NETWORK_STATE);
   \   0000F1                ; Setup parameters for call to function zgWriteStartupOptions
   \   0000F1   7A02         MOV     R2,#0x2
   \   0000F3   79FF         MOV     R1,#-0x1
   \   0000F5   12....       LCALL   ??zgWriteStartupOptions?relay; Banked call to: zgWriteStartupOptions
    824                    printf("clear\r\n");
   \   0000F8                ; Setup parameters for call to function printf
   \   0000F8   7A..         MOV     R2,#`?<Constant "clear\\r\\n">` & 0xff
   \   0000FA   7B..         MOV     R3,#(`?<Constant "clear\\r\\n">` >> 8) & 0xff
   \   0000FC   12....       LCALL   ??printf?relay       ; Banked call to: printf
    825                  }
    826                  
    827                  ReturnTorF( 1, 1 ); //正确
   \                     ??SampleApp_SerialCMD_4:
   \   0000FF                ; Setup parameters for call to function ReturnTorF
   \   0000FF   7C01         MOV     R4,#0x1
   \   000101   7D00         MOV     R5,#0x0
   \   000103   7A01         MOV     R2,#0x1
   \   000105   7B00         MOV     R3,#0x0
   \   000107   12....       LCALL   ??ReturnTorF?relay   ; Banked call to: ReturnTorF
    828                  SampleApp_SendPeriodicMessage(str, len); //转发复位指令给终端传感器
                                                       ^
Warning[Pe167]: argument of type "unsigned char *" is incompatible with
          parameter of type "char *"
   \   00010A                ; Setup parameters for call to function SampleApp_SendPeriodicMessage
   \   00010A   AC..         MOV     R4,?V0
   \   00010C   7D00         MOV     R5,#0x0
   \   00010E   EE           MOV     A,R6
   \   00010F   FA           MOV     R2,A
   \   000110   EF           MOV     A,R7
   \   000111   FB           MOV     R3,A
   \   000112   12....       LCALL   ??SampleApp_SendPeriodicMessage?relay; Banked call to: SampleApp_SendPeriodicMessage
    829                  
    830                  rs_flag = 1;//置位停止喂狗标志
   \   000115   90....       MOV     DPTR,#rs_flag
   \   000118   7401         MOV     A,#0x1
   \   00011A   F0           MOVX    @DPTR,A
   \   00011B   A3           INC     DPTR
   \   00011C   E4           CLR     A
   \   00011D   F0           MOVX    @DPTR,A
   \   00011E   02....       LJMP    ??SampleApp_SerialCMD_2 & 0xFFFF
    831                  
    832                }
    833                else if(osal_memcmp(str,"#GH",3)) //协调器使用GH指令给传感器设置光合表系数
   \                     ??SampleApp_SerialCMD_3:
   \   000121                ; Setup parameters for call to function osal_memcmp
   \   000121   75....       MOV     ?V4,#`?<Constant "#GH">` & 0xff
   \   000124   75....       MOV     ?V5,#(`?<Constant "#GH">` >> 8) & 0xff
   \   000127   78..         MOV     R0,#?V4
   \   000129   12....       LCALL   ?PUSH_XSTACK_I_THREE
   \   00012C   7C03         MOV     R4,#0x3
   \   00012E   7D00         MOV     R5,#0x0
   \   000130   8E82         MOV     DPL,R6
   \   000132   8F83         MOV     DPH,R7
   \   000134   A982         MOV     R1,DPL
   \   000136   AA83         MOV     R2,DPH
   \   000138   7B00         MOV     R3,#0x0
   \   00013A   12....       LCALL   ??osal_memcmp?relay  ; Banked call to: osal_memcmp
   \   00013D   7403         MOV     A,#0x3
   \   00013F   12....       LCALL   ?DEALLOC_XSTACK8
   \   000142   E9           MOV     A,R1
   \   000143   600E         JZ      ??SampleApp_SerialCMD_5
    834                {
    835                  SampleApp_SendPeriodicMessage(str, len);
                                                       ^
Warning[Pe167]: argument of type "unsigned char *" is incompatible with
          parameter of type "char *"
   \   000145                ; Setup parameters for call to function SampleApp_SendPeriodicMessage
   \   000145   AC..         MOV     R4,?V0
   \   000147   7D00         MOV     R5,#0x0
   \   000149   EE           MOV     A,R6
   \   00014A   FA           MOV     R2,A
   \   00014B   EF           MOV     A,R7
   \   00014C   FB           MOV     R3,A
   \   00014D   12....       LCALL   ??SampleApp_SendPeriodicMessage?relay; Banked call to: SampleApp_SendPeriodicMessage
   \   000150   02....       LJMP    ??SampleApp_SerialCMD_2 & 0xFFFF
    836                }
    837          #else //终端节点
    838                
    839                //设备ID读取和设置（ID）
    840                if(osal_memcmp(str,"#ID",3))
    841                {
    842                  if(len == 5) //读取设备ID
    843                  {          
    844                    printf("<ID,%03u>\r\n", sensor_id);
    845                  }
    846                  else //设置设备ID
    847                  {
    848                    int temp_id;
    849                    
    850                    sscanf(str+4, "%d", &temp_id);                           
    851                    if(temp_id>=1 && temp_id<=3)
    852                    {
    853                      sensor_id = temp_id;
    854                      
    855                      /* 设备ID存入flash */
    856                      sprintf(dev_id, "%03u", sensor_id);
    857                      
    858                      if(SUCCESS == osal_nv_write(DEVICE_ID, 0, DEVICE_ID_LEN, dev_id))
    859                        ReturnTorF( 1, 1 ); //存入成功
    860                      else
    861                        ReturnTorF( 0, 1 ); //存入失败
    862                    }
    863                    else
    864                    {
    865                      ReturnTorF( 0, 1 ); //错误
    866                    }
    867                  }
    868                }
    869                
    870                //光合表读取和设置（GH）
    871                else if(osal_memcmp(str,"#GH",3))
    872                {
    873                  if(len == 5) //读取光合表系数
    874                  {
    875                    printf("<GH,%03u,%.2f>\r\n", sensor_id, gh_factor);
    876                  }
    877                  else //设置光合表系数
    878                  {
    879                    float temp_gh;
    880                    char *p = NULL;
    881                    
    882                    p = strchr(str, ','); //查找第一个","出现的位置
    883                    p = strchr(p+1, ','); //查找第二个","出现的位置
    884                    sscanf(p+1, "%f", &temp_gh);
    885                    if(temp_gh>=1.0)
    886                    {
    887                      gh_factor = temp_gh;
    888                      
    889                      /* 光合表系数存入flash */
    890                      sprintf(dev_gh, "%5.2f", gh_factor);
    891                      
    892                      if(SUCCESS == osal_nv_write(DEVICE_GH, 0, DEVICE_GH_LEN, dev_gh))
    893                        ReturnTorF( 1, 1 ); //存入成功
    894                      else
    895                        ReturnTorF( 0, 1 ); //存入失败
    896                    }
    897                    else
    898                    {
    899                      ReturnTorF( 0, 1 ); //错误
    900                    }
    901                  }
    902                }
    903                
    904                //复位指令（RS）
    905                else if(osal_memcmp(str,"#RS",3)) 
    906                {
    907                  /* 复位 */
    908                  if((len>5)&&(atoi(str+4)!=0))  //参数不为0清除掉网络信息
    909                  {
    910                    zgWriteStartupOptions(ZG_STARTUP_SET, ZCD_STARTOPT_DEFAULT_NETWORK_STATE);
    911                    printf("clear\r\n");
    912                  }
    913                  ReturnTorF( 1, 1 );//复位成功
    914                  rs_flag = 1;//置位停止喂狗标志
    915                }
    916                
    917                //温度订正（CR）
    918                else if(osal_memcmp(str,"#CR",3)) //温度订正
    919                {
    920                  if( len == 5 ) //读取温度订正值
    921                  {
    922                    printf("<CR,%.2f>\r\n", cal_t0);
    923                  }
    924                  else if( len > 5 )
    925                  {
    926                    float temp_wddt;
    927                    char *p = NULL;
    928                      
    929                    p = strchr(str, ','); //查找第一个","出现的位置
    930                    sscanf( p+1, "%f", &temp_wddt);
    931                    if( temp_wddt>-10.0 && temp_wddt<10.00 )
    932                    {
    933                      cal_t0 = temp_wddt;
    934                       /* 温度订正存入flash */
    935                      sprintf(dev_wddt, "%5.2f", cal_t0);
    936                      
    937                      if(SUCCESS == osal_nv_write(DEVICE_WDDT, 0, DEVICE_WDDT_LEN, dev_wddt))
    938                        ReturnTorF( 1, 1 ); //存入成功
    939                      else
    940                        ReturnTorF( 0, 1 ); //存入失败
    941                      
    942                    }
    943                    else
    944                    {
    945                      ReturnTorF( 0, 1 );
    946                    }
    947                     
    948                  }
    949                  else
    950                  {
    951                    ReturnTorF( 0, 1 );
    952                  }
    953                }
    954          #endif
    955                //查询或设置PANID（PD）
    956                else if(osal_memcmp(str,"#PD",3))
   \                     ??SampleApp_SerialCMD_5:
   \   000153                ; Setup parameters for call to function osal_memcmp
   \   000153   75....       MOV     ?V4,#`?<Constant "#PD">` & 0xff
   \   000156   75....       MOV     ?V5,#(`?<Constant "#PD">` >> 8) & 0xff
   \   000159   78..         MOV     R0,#?V4
   \   00015B   12....       LCALL   ?PUSH_XSTACK_I_THREE
   \   00015E   7C03         MOV     R4,#0x3
   \   000160   7D00         MOV     R5,#0x0
   \   000162   8E82         MOV     DPL,R6
   \   000164   8F83         MOV     DPH,R7
   \   000166   A982         MOV     R1,DPL
   \   000168   AA83         MOV     R2,DPH
   \   00016A   7B00         MOV     R3,#0x0
   \   00016C   12....       LCALL   ??osal_memcmp?relay  ; Banked call to: osal_memcmp
   \   00016F   7403         MOV     A,#0x3
   \   000171   12....       LCALL   ?DEALLOC_XSTACK8
   \   000174   E9           MOV     A,R1
   \   000175   6046         JZ      ??SampleApp_SerialCMD_6
    957                {
    958                  if(len==5)  //读取
   \   000177   7405         MOV     A,#0x5
   \   000179   65..         XRL     A,?V0
   \   00017B   700D         JNZ     ??SampleApp_SerialCMD_7
    959                  {
    960                    printf("<PD,0x%04X>\r\n", _NIB.nwkPanId);
   \   00017D                ; Setup parameters for call to function printf
   \   00017D   90....       MOV     DPTR,#_NIB + 33
   \   000180   12....       LCALL   ?PUSH_XSTACK8_X_TWO
   \   000183   7A..         MOV     R2,#`?<Constant "<PD,0x%04X>\\r\\n">` & 0xff
   \   000185   7B..         MOV     R3,#(`?<Constant "<PD,0x%04X>\\r\\n">` >> 8) & 0xff
   \   000187   02....       LJMP    ??SampleApp_SerialCMD_8 & 0xFFFF
    961                  }
    962                  else if(len>5)  //设置
   \                     ??SampleApp_SerialCMD_7:
   \   00018A   E5..         MOV     A,?V0
   \   00018C   C3           CLR     C
   \   00018D   9406         SUBB    A,#0x6
   \   00018F   5003         JNC     $+5
   \   000191   02....       LJMP    ??SampleApp_SerialCMD_0 & 0xFFFF
    963                  {
    964                    uint16 panid=0;
   \   000194   12....       LCALL   ?Subroutine2 & 0xFFFF
    965                    
    966                    sscanf(str+4,"%x",&panid);  //得到新的PanID
                                  ^
Warning[Pe167]: argument of type "unsigned char *" is incompatible with
          parameter of type "char const *"
   \                     ??CrossCallReturnLabel_0:
   \   000197   12....       LCALL   ?PUSH_XSTACK_I_TWO
   \   00019A   12....       LCALL   ?Subroutine7 & 0xFFFF
   \                     ??CrossCallReturnLabel_37:
   \   00019D   12....       LCALL   ??sscanf?relay       ; Banked call to: sscanf
   \   0001A0   7402         MOV     A,#0x2
   \   0001A2   12....       LCALL   ?DEALLOC_XSTACK8
    967                    _NIB.nwkPanId=panid;  //更新PanID
   \   0001A5   85..82       MOV     DPL,?XSP + 0
   \   0001A8   85..83       MOV     DPH,?XSP + 1
   \   0001AB   E0           MOVX    A,@DPTR
   \   0001AC   F8           MOV     R0,A
   \   0001AD   A3           INC     DPTR
   \   0001AE   E0           MOVX    A,@DPTR
   \   0001AF   F9           MOV     R1,A
   \   0001B0   90....       MOV     DPTR,#_NIB + 33
   \   0001B3   E8           MOV     A,R0
   \   0001B4   F0           MOVX    @DPTR,A
   \   0001B5   A3           INC     DPTR
   \   0001B6   E9           MOV     A,R1
   \   0001B7   F0           MOVX    @DPTR,A
    968                    
    969                    /* 2017.4.10添加使能NV_INIT和NV_RESTORE时设置channel和panid时同时清除掉节点保存的协调器网络信息，
    970                       这样便可以在更改channel或panid后加入有相同channel和panid的任意协调器的网络而不会更换协调器后无法入网，
    971                       但还是需要重启节点才能加入新网络，而且PANID编译时需要设为0xFFFF，channel要选则全部11-26通道 */
    972                    _NIB.nwkCoordAddress = INVALID_NODE_ADDR;
   \   0001B8   90....       MOV     DPTR,#_NIB + 23
   \   0001BB   8066         SJMP    ??SampleApp_SerialCMD_9
    973                    osal_memset( _NIB.nwkCoordExtAddress, 0, Z_EXTADDR_LEN );
    974                    /* */
    975                    
    976                    NLME_UpdateNV(0x01);  //将 NIB 信息存入 NV 中，重启后使用新的PanID
    977                    
    978                    ReturnTorF( 1, 1 );
    979                  }
    980                  else
    981                  {
    982                    ReturnTorF( 0, 1 );
    983                  }
    984                }
    985                
    986                //查询设置信道号（CH）
    987                else if(osal_memcmp(str,"#CH",3))
   \                     ??SampleApp_SerialCMD_6:
   \   0001BD                ; Setup parameters for call to function osal_memcmp
   \   0001BD   75....       MOV     ?V4,#`?<Constant "#CH">` & 0xff
   \   0001C0   75....       MOV     ?V5,#(`?<Constant "#CH">` >> 8) & 0xff
   \   0001C3   78..         MOV     R0,#?V4
   \   0001C5   12....       LCALL   ?PUSH_XSTACK_I_THREE
   \   0001C8   7C03         MOV     R4,#0x3
   \   0001CA   7D00         MOV     R5,#0x0
   \   0001CC   8E82         MOV     DPL,R6
   \   0001CE   8F83         MOV     DPH,R7
   \   0001D0   A982         MOV     R1,DPL
   \   0001D2   AA83         MOV     R2,DPH
   \   0001D4   7B00         MOV     R3,#0x0
   \   0001D6   12....       LCALL   ??osal_memcmp?relay  ; Banked call to: osal_memcmp
   \   0001D9   7403         MOV     A,#0x3
   \   0001DB   12....       LCALL   ?DEALLOC_XSTACK8
   \   0001DE   E9           MOV     A,R1
   \   0001DF   605D         JZ      ??SampleApp_SerialCMD_10
    988                {
    989                  if(len==5)  //读取
   \   0001E1   7405         MOV     A,#0x5
   \   0001E3   65..         XRL     A,?V0
   \   0001E5   7015         JNZ     ??SampleApp_SerialCMD_11
    990                  {
    991                    printf("<CH,0x%02X>\r\n", _NIB.nwkLogicalChannel);
   \   0001E7                ; Setup parameters for call to function printf
   \   0001E7   90....       MOV     DPTR,#_NIB + 22
   \   0001EA   E0           MOVX    A,@DPTR
   \   0001EB   F5..         MOV     ?V0,A
   \   0001ED   75..00       MOV     ?V1,#0x0
   \   0001F0   78..         MOV     R0,#?V0
   \   0001F2   12....       LCALL   ?PUSH_XSTACK_I_TWO
   \   0001F5   7A..         MOV     R2,#`?<Constant "<CH,0x%02X>\\r\\n">` & 0xff
   \   0001F7   7B..         MOV     R3,#(`?<Constant "<CH,0x%02X>\\r\\n">` >> 8) & 0xff
   \   0001F9   02....       LJMP    ??SampleApp_SerialCMD_8 & 0xFFFF
    992                  }
    993                  else if(len>5)  //设置
   \                     ??SampleApp_SerialCMD_11:
   \   0001FC   E5..         MOV     A,?V0
   \   0001FE   C3           CLR     C
   \   0001FF   9406         SUBB    A,#0x6
   \   000201   5003         JNC     $+5
   \   000203   02....       LJMP    ??SampleApp_SerialCMD_0 & 0xFFFF
    994                  {
    995                    uint16 channel=0;
   \   000206   12....       LCALL   ?Subroutine2 & 0xFFFF
    996                    
    997                    sscanf(str+4,"%x",&channel);  //得到新的channel
                                  ^
Warning[Pe167]: argument of type "unsigned char *" is incompatible with
          parameter of type "char const *"
   \                     ??CrossCallReturnLabel_1:
   \   000209   12....       LCALL   ?PUSH_XSTACK_I_TWO
   \   00020C   12....       LCALL   ?Subroutine7 & 0xFFFF
   \                     ??CrossCallReturnLabel_38:
   \   00020F   12....       LCALL   ??sscanf?relay       ; Banked call to: sscanf
   \   000212   7402         MOV     A,#0x2
   \   000214   12....       LCALL   ?DEALLOC_XSTACK8
    998                    _NIB.nwkLogicalChannel=channel;  //更新channel
   \   000217   85..82       MOV     DPL,?XSP + 0
   \   00021A   85..83       MOV     DPH,?XSP + 1
   \   00021D   E0           MOVX    A,@DPTR
   \   00021E   90....       MOV     DPTR,#_NIB + 22
   \   000221   F0           MOVX    @DPTR,A
    999                    
   1000                    /* 2017.4.10添加使能NV_INIT和NV_RESTORE时设置channel和panid时同时清除掉节点保存的协调器网络信息，
   1001                       这样便可以在更改channel或panid后加入有相同channel和panid的任意协调器的网络而不会更换协调器后无法入网，
   1002                       但还是需要重启节点才能加入新网络，而且PANID编译时需要设为0xFFFF，channel要选则全部11-26通道 */
   1003                    _NIB.nwkCoordAddress = INVALID_NODE_ADDR;
   \   000222   A3           INC     DPTR
   \                     ??SampleApp_SerialCMD_9:
   \   000223   74FE         MOV     A,#-0x2
   \   000225   F0           MOVX    @DPTR,A
   \   000226   A3           INC     DPTR
   \   000227   04           INC     A
   \   000228   F0           MOVX    @DPTR,A
   1004                    osal_memset( _NIB.nwkCoordExtAddress, 0, Z_EXTADDR_LEN );
   \   000229                ; Setup parameters for call to function osal_memset
   \   000229   7C08         MOV     R4,#0x8
   \   00022B   7D00         MOV     R5,#0x0
   \   00022D   7900         MOV     R1,#0x0
   \   00022F   7A..         MOV     R2,#(_NIB + 25) & 0xff
   \   000231   7B..         MOV     R3,#((_NIB + 25) >> 8) & 0xff
   \   000233   12....       LCALL   ??osal_memset?relay  ; Banked call to: osal_memset
   1005                    /* */
   1006                    
   1007                    NLME_UpdateNV(0x01);  //将 NIB 信息存入 NV 中，重启后应用
   \   000236                ; Setup parameters for call to function NLME_UpdateNV
   \   000236   7901         MOV     R1,#0x1
   \   000238   12....       LCALL   ??NLME_UpdateNV?relay; Banked call to: NLME_UpdateNV
   1008                    
   1009                    ReturnTorF( 1, 1 );
   \   00023B                ; Setup parameters for call to function ReturnTorF
   \   00023B   02....       LJMP    ??SampleApp_SerialCMD_12 & 0xFFFF
   1010                  }
   1011                  else
   1012                  {
   1013                    ReturnTorF( 0, 1 );
   1014                  }
   1015                }
   1016                
   1017                //查询短地址（SA）
   1018                else if(osal_memcmp(str,"#SA",3))
   \                     ??SampleApp_SerialCMD_10:
   \   00023E                ; Setup parameters for call to function osal_memcmp
   \   00023E   75....       MOV     ?V4,#`?<Constant "#SA">` & 0xff
   \   000241   75....       MOV     ?V5,#(`?<Constant "#SA">` >> 8) & 0xff
   \   000244   78..         MOV     R0,#?V4
   \   000246   12....       LCALL   ?PUSH_XSTACK_I_THREE
   \   000249   7C03         MOV     R4,#0x3
   \   00024B   7D00         MOV     R5,#0x0
   \   00024D   8E82         MOV     DPL,R6
   \   00024F   8F83         MOV     DPH,R7
   \   000251   A982         MOV     R1,DPL
   \   000253   AA83         MOV     R2,DPH
   \   000255   7B00         MOV     R3,#0x0
   \   000257   12....       LCALL   ??osal_memcmp?relay  ; Banked call to: osal_memcmp
   \   00025A   7403         MOV     A,#0x3
   \   00025C   12....       LCALL   ?DEALLOC_XSTACK8
   \   00025F   E9           MOV     A,R1
   \   000260   600D         JZ      ??SampleApp_SerialCMD_13
   1019                {
   1020                  printf("<SA,0x%04X>\r\n", _NIB.nwkDevAddress);
   \   000262                ; Setup parameters for call to function printf
   \   000262   90....       MOV     DPTR,#_NIB + 20
   \   000265   12....       LCALL   ?PUSH_XSTACK8_X_TWO
   \   000268   7A..         MOV     R2,#`?<Constant "<SA,0x%04X>\\r\\n">` & 0xff
   \   00026A   7B..         MOV     R3,#(`?<Constant "<SA,0x%04X>\\r\\n">` >> 8) & 0xff
   \   00026C   02....       LJMP    ??SampleApp_SerialCMD_8 & 0xFFFF
   1021                }
   1022                
   1023                /* 2017.4.10添加修改入网时默认的chennel和panid，不打开NV_INIT和NV_RESTORE；
   1024                   仅终端节点添加，协调器还是使用NV_INIT和NV_RESTORE保持不变，因为协调器需要保存网络信息如邻居表等，
   1025                   这样终端节点重新入网后地址等信息不会改变 */
   1026                /* 16.8.5添加DCH和CPD命令读取和设置默认入网信道和PANID，这样原来的CH和PD命令用来查看当前网络的信道和PANID */
   1027                //查询或设置默认入网PANID（DPD）
   1028                else if(osal_memcmp(str,"#DPD",3))
   \                     ??SampleApp_SerialCMD_13:
   \   00026F                ; Setup parameters for call to function osal_memcmp
   \   00026F   75....       MOV     ?V4,#`?<Constant "#DPD">` & 0xff
   \   000272   75....       MOV     ?V5,#(`?<Constant "#DPD">` >> 8) & 0xff
   \   000275   78..         MOV     R0,#?V4
   \   000277   12....       LCALL   ?PUSH_XSTACK_I_THREE
   \   00027A   7C03         MOV     R4,#0x3
   \   00027C   7D00         MOV     R5,#0x0
   \   00027E   8E82         MOV     DPL,R6
   \   000280   8F83         MOV     DPH,R7
   \   000282   A982         MOV     R1,DPL
   \   000284   AA83         MOV     R2,DPH
   \   000286   7B00         MOV     R3,#0x0
   \   000288   12....       LCALL   ??osal_memcmp?relay  ; Banked call to: osal_memcmp
   \   00028B   7403         MOV     A,#0x3
   \   00028D   12....       LCALL   ?DEALLOC_XSTACK8
   \   000290   E9           MOV     A,R1
   \   000291   6074         JZ      ??SampleApp_SerialCMD_14
   1029                {
   1030                  if(len==6)  //读取
   \   000293   7406         MOV     A,#0x6
   \   000295   65..         XRL     A,?V0
   \   000297   700D         JNZ     ??SampleApp_SerialCMD_15
   1031                  {
   1032                    printf("<DPD,0x%04X>\r\n", zgConfigPANID);   /* 默认PANID */
   \   000299                ; Setup parameters for call to function printf
   \   000299   90....       MOV     DPTR,#zgConfigPANID
   \   00029C   12....       LCALL   ?PUSH_XSTACK8_X_TWO
   \   00029F   7A..         MOV     R2,#`?<Constant "<DPD,0x%04X>\\r\\n">` & 0xff
   \   0002A1   7B..         MOV     R3,#(`?<Constant "<DPD,0x%04X>\\r\\n">` >> 8) & 0xff
   \   0002A3   02....       LJMP    ??SampleApp_SerialCMD_8 & 0xFFFF
   1033                  }
   1034                  else if(len>6)  //设置
   \                     ??SampleApp_SerialCMD_15:
   \   0002A6   E5..         MOV     A,?V0
   \   0002A8   C3           CLR     C
   \   0002A9   9407         SUBB    A,#0x7
   \   0002AB   4053         JC      ??SampleApp_SerialCMD_16
   1035                  {
   1036                    uint16 panid=0;
   \   0002AD   12....       LCALL   ?Subroutine2 & 0xFFFF
   1037                    
   1038                    sscanf(str+5,"%x",&panid);  //得到新的PanID
                                  ^
Warning[Pe167]: argument of type "unsigned char *" is incompatible with
          parameter of type "char const *"
   \                     ??CrossCallReturnLabel_2:
   \   0002B0   12....       LCALL   ?PUSH_XSTACK_I_TWO
   \   0002B3   7C..         MOV     R4,#`?<Constant "%x">` & 0xff
   \   0002B5   7D..         MOV     R5,#(`?<Constant "%x">` >> 8) & 0xff
   \   0002B7   EE           MOV     A,R6
   \   0002B8   2405         ADD     A,#0x5
   \   0002BA   FA           MOV     R2,A
   \   0002BB   E4           CLR     A
   \   0002BC   3F           ADDC    A,R7
   \   0002BD   FB           MOV     R3,A
   \   0002BE   12....       LCALL   ??sscanf?relay       ; Banked call to: sscanf
   \   0002C1   7402         MOV     A,#0x2
   \   0002C3   12....       LCALL   ?DEALLOC_XSTACK8
   1039                    
   1040                    extern uint8 nvItemInit( uint16 id, uint16 len, void *buf, uint8 set );
   1041                    zgConfigPANID = panid;   /* 修改默认panid */
   \   0002C6   85..82       MOV     DPL,?XSP + 0
   \   0002C9   85..83       MOV     DPH,?XSP + 1
   \   0002CC   E0           MOVX    A,@DPTR
   \   0002CD   F8           MOV     R0,A
   \   0002CE   A3           INC     DPTR
   \   0002CF   E0           MOVX    A,@DPTR
   \   0002D0   F9           MOV     R1,A
   \   0002D1   90....       MOV     DPTR,#zgConfigPANID
   \   0002D4   E8           MOV     A,R0
   \   0002D5   F0           MOVX    @DPTR,A
   \   0002D6   A3           INC     DPTR
   \   0002D7   E9           MOV     A,R1
   \   0002D8   F0           MOVX    @DPTR,A
   1042                    //保存到NV
   1043                    if(nvItemInit(ZCD_NV_PANID,sizeof(zgConfigPANID), &zgConfigPANID,TRUE) != ZSUCCESS)
   \   0002D9                ; Setup parameters for call to function nvItemInit
   \   0002D9   75....       MOV     ?V0,#zgConfigPANID & 0xff
   \   0002DC   75....       MOV     ?V1,#(zgConfigPANID >> 8) & 0xff
   \   0002DF   78..         MOV     R0,#?V0
   \   0002E1   12....       LCALL   ?PUSH_XSTACK_I_TWO
   \   0002E4   7901         MOV     R1,#0x1
   \   0002E6   7C02         MOV     R4,#0x2
   \   0002E8   7D00         MOV     R5,#0x0
   \   0002EA   7A83         MOV     R2,#-0x7d
   \   0002EC   7B00         MOV     R3,#0x0
   \   0002EE   12....       LCALL   ??nvItemInit?relay   ; Banked call to: nvItemInit
   \   0002F1   7402         MOV     A,#0x2
   \   0002F3   12....       LCALL   ?DEALLOC_XSTACK8
   \   0002F6   E9           MOV     A,R1
   \   0002F7   7007         JNZ     ??SampleApp_SerialCMD_16
   1044                    {
   1045                      printf("<DPD,F>\r\n");
   1046                    }
   1047                    else
   1048                    {
   1049                      printf("<DPD,T>\r\n");
   \   0002F9                ; Setup parameters for call to function printf
   \   0002F9   7A..         MOV     R2,#`?<Constant "<DPD,T>\\r\\n">` & 0xff
   \   0002FB   7B..         MOV     R3,#(`?<Constant "<DPD,T>\\r\\n">` >> 8) & 0xff
   \   0002FD   02....       LJMP    ??SampleApp_SerialCMD_17 & 0xFFFF
   1050                    }
   1051                    
   1052                  }
   1053                  else
   1054                  {
   1055                    printf("<DPD,F>\r\n");
   \                     ??SampleApp_SerialCMD_16:
   \   000300                ; Setup parameters for call to function printf
   \   000300   7A..         MOV     R2,#`?<Constant "<DPD,F>\\r\\n">` & 0xff
   \   000302   7B..         MOV     R3,#(`?<Constant "<DPD,F>\\r\\n">` >> 8) & 0xff
   \   000304   02....       LJMP    ??SampleApp_SerialCMD_17 & 0xFFFF
   1056                  }
   1057                }
   1058                
   1059                
   1060                //查询设置默认入网信道号（DCH）
   1061                else if(osal_memcmp(str,"#DCH",4))
   \                     ??SampleApp_SerialCMD_14:
   \   000307                ; Setup parameters for call to function osal_memcmp
   \   000307   75....       MOV     ?V4,#`?<Constant "#DCH">` & 0xff
   \   00030A   75....       MOV     ?V5,#(`?<Constant "#DCH">` >> 8) & 0xff
   \   00030D   78..         MOV     R0,#?V4
   \   00030F   12....       LCALL   ?PUSH_XSTACK_I_THREE
   \   000312   7C04         MOV     R4,#0x4
   \   000314   7D00         MOV     R5,#0x0
   \   000316   8E82         MOV     DPL,R6
   \   000318   8F83         MOV     DPH,R7
   \   00031A   A982         MOV     R1,DPL
   \   00031C   AA83         MOV     R2,DPH
   \   00031E   7B00         MOV     R3,#0x0
   \   000320   12....       LCALL   ??osal_memcmp?relay  ; Banked call to: osal_memcmp
   \   000323   7403         MOV     A,#0x3
   \   000325   12....       LCALL   ?DEALLOC_XSTACK8
   \   000328   E9           MOV     A,R1
   \   000329   7003         JNZ     $+5
   \   00032B   02....       LJMP    ??SampleApp_SerialCMD_18 & 0xFFFF
   1062                {
   1063                  if(len==6)  //读取
   \   00032E   7406         MOV     A,#0x6
   \   000330   65..         XRL     A,?V0
   \   000332   7051         JNZ     ??SampleApp_SerialCMD_19
   1064                  {
   1065                    if(zgDefaultChannelList == MAX_CHANNELS_24GHZ)  //通道全选
   \   000334   90....       MOV     DPTR,#__Constant_7fff800
   \   000337   78..         MOV     R0,#?V0
   \   000339   12....       LCALL   ?L_MOV_X
   \   00033C   90....       MOV     DPTR,#zgDefaultChannelList
   \   00033F   78..         MOV     R0,#?V0
   \   000341   12....       LCALL   ?L_EQ_X
   \   000344   7007         JNZ     ??SampleApp_SerialCMD_20
   1066                    {
   1067                      printf("<DCH,ALL>\r\n");
   \   000346                ; Setup parameters for call to function printf
   \   000346   7A..         MOV     R2,#`?<Constant "<DCH,ALL>\\r\\n">` & 0xff
   \   000348   7B..         MOV     R3,#(`?<Constant "<DCH,ALL>\\r\\n">` >> 8) & 0xff
   \   00034A   02....       LJMP    ??SampleApp_SerialCMD_17 & 0xFFFF
   1068                    }
   1069                    else
   1070                    {
   1071                      for(i=11;i<=26;i++)  //根据channel list得到信道，信道设置时只选一个或者全选
   \                     ??SampleApp_SerialCMD_20:
   \   00034D   75..0B       MOV     ?V4,#0xb
   1072                      {
   1073                        if(zgDefaultChannelList&((uint32)1<<i)) break;
   \                     ??SampleApp_SerialCMD_21:
   \   000350   90....       MOV     DPTR,#zgDefaultChannelList
   \   000353   78..         MOV     R0,#?V0
   \   000355   12....       LCALL   ?L_MOV_X
   \   000358   E5..         MOV     A,?V4
   \   00035A   78..         MOV     R0,#?V0
   \   00035C   12....       LCALL   ?UL_SHR
   \   00035F   E5..         MOV     A,?V0
   \   000361   A2E0         MOV     C,0xE0 /* A   */.0
   \   000363   4009         JC      ??SampleApp_SerialCMD_22
   1074                      }
   \   000365   05..         INC     ?V4
   \   000367   E5..         MOV     A,?V4
   \   000369   C3           CLR     C
   \   00036A   941B         SUBB    A,#0x1b
   \   00036C   40E2         JC      ??SampleApp_SerialCMD_21
   1075                      printf("<DCH,0x%02X>\r\n", i);
   \                     ??SampleApp_SerialCMD_22:
   \   00036E                ; Setup parameters for call to function printf
   \   00036E   75..00       MOV     ?V5,#0x0
   \   000371   78..         MOV     R0,#?V4
   \   000373   12....       LCALL   ?PUSH_XSTACK_I_TWO
   \   000376   7A..         MOV     R2,#`?<Constant "<DCH,0x%02X>\\r\\n">` & 0xff
   \   000378   7B..         MOV     R3,#(`?<Constant "<DCH,0x%02X>\\r\\n">` >> 8) & 0xff
   \                     ??SampleApp_SerialCMD_8:
   \   00037A   12....       LCALL   ??printf?relay       ; Banked call to: printf
   \   00037D   7402         MOV     A,#0x2
   \   00037F   12....       LCALL   ?DEALLOC_XSTACK8
   \   000382   02....       LJMP    ??SampleApp_SerialCMD_2 & 0xFFFF
   1076                    }
   1077                  }
   1078                  else if(len>6)  //设置
   \                     ??SampleApp_SerialCMD_19:
   \   000385   E5..         MOV     A,?V0
   \   000387   C3           CLR     C
   \   000388   9407         SUBB    A,#0x7
   \   00038A   5003         JNC     $+5
   \   00038C   02....       LJMP    ??SampleApp_SerialCMD_23 & 0xFFFF
   1079                  {
   1080                    uint16 channel=0;
   \   00038F   85..82       MOV     DPL,?XSP + 0
   \   000392   85..83       MOV     DPH,?XSP + 1
   \   000395   E4           CLR     A
   \   000396   F0           MOVX    @DPTR,A
   \   000397   A3           INC     DPTR
   \   000398   F0           MOVX    @DPTR,A
   1081                    
   1082                    sscanf(str+5,"%x",&channel);  //得到新的channel
                                  ^
Warning[Pe167]: argument of type "unsigned char *" is incompatible with
          parameter of type "char const *"
   \   000399   EE           MOV     A,R6
   \   00039A   2405         ADD     A,#0x5
   \   00039C   F5..         MOV     ?V0,A
   \   00039E   E4           CLR     A
   \   00039F   3F           ADDC    A,R7
   \   0003A0   F5..         MOV     ?V1,A
   \   0003A2                ; Setup parameters for call to function sscanf
   \   0003A2   A8..         MOV     R0,?XSP + 0
   \   0003A4   A9..         MOV     R1,?XSP + 1
   \   0003A6   88..         MOV     ?V2,R0
   \   0003A8   89..         MOV     ?V3,R1
   \   0003AA   78..         MOV     R0,#?V2
   \   0003AC   12....       LCALL   ?PUSH_XSTACK_I_TWO
   \   0003AF   7C..         MOV     R4,#`?<Constant "%x">` & 0xff
   \   0003B1   7D..         MOV     R5,#(`?<Constant "%x">` >> 8) & 0xff
   \   0003B3   AA..         MOV     R2,?V0
   \   0003B5   AB..         MOV     R3,?V1
   \   0003B7   12....       LCALL   ??sscanf?relay       ; Banked call to: sscanf
   \   0003BA   7402         MOV     A,#0x2
   \   0003BC   12....       LCALL   ?DEALLOC_XSTACK8
   1083                    
   1084                    /* 2017.4.10如果信道设置为"ALL"或"all"时表示通道全选，此时将channel设为0表示通道全选 */
   1085                    if(osal_memcmp(str+5,"ALL",3) || osal_memcmp(str+5,"all",3))  //11-26通道全选
   \   0003BF                ; Setup parameters for call to function osal_memcmp
   \   0003BF   75....       MOV     ?V4,#`?<Constant "ALL">` & 0xff
   \   0003C2   75....       MOV     ?V5,#(`?<Constant "ALL">` >> 8) & 0xff
   \   0003C5   78..         MOV     R0,#?V4
   \   0003C7   12....       LCALL   ?PUSH_XSTACK_I_THREE
   \   0003CA   7C03         MOV     R4,#0x3
   \   0003CC   7D00         MOV     R5,#0x0
   \   0003CE   85..82       MOV     DPL,?V0
   \   0003D1   85..83       MOV     DPH,?V1
   \   0003D4   A982         MOV     R1,DPL
   \   0003D6   AA83         MOV     R2,DPH
   \   0003D8   7B00         MOV     R3,#0x0
   \   0003DA   12....       LCALL   ??osal_memcmp?relay  ; Banked call to: osal_memcmp
   \   0003DD   7403         MOV     A,#0x3
   \   0003DF   12....       LCALL   ?DEALLOC_XSTACK8
   \   0003E2   E9           MOV     A,R1
   \   0003E3   702C         JNZ     ??SampleApp_SerialCMD_24
   \   0003E5                ; Setup parameters for call to function osal_memcmp
   \   0003E5   75....       MOV     ?V0,#`?<Constant "all">` & 0xff
   \   0003E8   75....       MOV     ?V1,#(`?<Constant "all">` >> 8) & 0xff
   \   0003EB   75..00       MOV     ?V2,#0x0
   \   0003EE   78..         MOV     R0,#?V0
   \   0003F0   12....       LCALL   ?PUSH_XSTACK_I_THREE
   \   0003F3   7C03         MOV     R4,#0x3
   \   0003F5   7D00         MOV     R5,#0x0
   \   0003F7   8E82         MOV     DPL,R6
   \   0003F9   8F83         MOV     DPH,R7
   \   0003FB   A3           INC     DPTR
   \   0003FC   A3           INC     DPTR
   \   0003FD   A3           INC     DPTR
   \   0003FE   A3           INC     DPTR
   \   0003FF   A3           INC     DPTR
   \   000400   A982         MOV     R1,DPL
   \   000402   AA83         MOV     R2,DPH
   \   000404   7B00         MOV     R3,#0x0
   \   000406   12....       LCALL   ??osal_memcmp?relay  ; Banked call to: osal_memcmp
   \   000409   7403         MOV     A,#0x3
   \   00040B   12....       LCALL   ?DEALLOC_XSTACK8
   \   00040E   E9           MOV     A,R1
   \   00040F   600C         JZ      ??SampleApp_SerialCMD_25
   1086                    {
   1087                      channel=0;
   \                     ??SampleApp_SerialCMD_24:
   \   000411   85..82       MOV     DPL,?XSP + 0
   \   000414   85..83       MOV     DPH,?XSP + 1
   \   000417   E4           CLR     A
   \   000418   F0           MOVX    @DPTR,A
   \   000419   A3           INC     DPTR
   \   00041A   F0           MOVX    @DPTR,A
   \   00041B   802B         SJMP    ??SampleApp_SerialCMD_26
   1088                    }
   1089                    
   1090                    extern uint8 nvItemInit( uint16 id, uint16 len, void *buf, uint8 set );
   1091                    if(((channel<11) || (channel>26)) && (channel!=0))  //无效信道且不为0
   \                     ??SampleApp_SerialCMD_25:
   \   00041D   85..82       MOV     DPL,?XSP + 0
   \   000420   85..83       MOV     DPH,?XSP + 1
   \   000423   E0           MOVX    A,@DPTR
   \   000424   24F5         ADD     A,#-0xb
   \   000426   F8           MOV     R0,A
   \   000427   A3           INC     DPTR
   \   000428   E0           MOVX    A,@DPTR
   \   000429   34FF         ADDC    A,#-0x1
   \   00042B   F9           MOV     R1,A
   \   00042C   C3           CLR     C
   \   00042D   E8           MOV     A,R0
   \   00042E   9410         SUBB    A,#0x10
   \   000430   E9           MOV     A,R1
   \   000431   9400         SUBB    A,#0x0
   \   000433   85..82       MOV     DPL,?XSP + 0
   \   000436   85..83       MOV     DPH,?XSP + 1
   \   000439   12....       LCALL   ?Subroutine6 & 0xFFFF
   \                     ??CrossCallReturnLabel_10:
   \   00043C   4008         JC      ??SampleApp_SerialCMD_27
   \   00043E   6008         JZ      ??SampleApp_SerialCMD_26
   1092                    {
   1093                      printf("<CH,F>\r\n");
   \   000440                ; Setup parameters for call to function printf
   \   000440   7A..         MOV     R2,#`?<Constant "<CH,F>\\r\\n">` & 0xff
   \   000442   7B..         MOV     R3,#(`?<Constant "<CH,F>\\r\\n">` >> 8) & 0xff
   \   000444   8076         SJMP    ??SampleApp_SerialCMD_17
   1094                    }
   1095                    else
   1096                    {
   1097                      //根据channel得到channel list，注意强制类型转换
   1098                      if(channel==0)  //为0时将信道全选
   \                     ??SampleApp_SerialCMD_27:
   \   000446   7013         JNZ     ??SampleApp_SerialCMD_28
   1099                      {
   1100                        zgDefaultChannelList=MAX_CHANNELS_24GHZ;
   \                     ??SampleApp_SerialCMD_26:
   \   000448   90....       MOV     DPTR,#zgDefaultChannelList
   \   00044B   E4           CLR     A
   \   00044C   F0           MOVX    @DPTR,A
   \   00044D   A3           INC     DPTR
   \   00044E   74F8         MOV     A,#-0x8
   \   000450   F0           MOVX    @DPTR,A
   \   000451   A3           INC     DPTR
   \   000452   74FF         MOV     A,#-0x1
   \   000454   F0           MOVX    @DPTR,A
   \   000455   A3           INC     DPTR
   \   000456   7407         MOV     A,#0x7
   \   000458   F0           MOVX    @DPTR,A
   \   000459   801D         SJMP    ??SampleApp_SerialCMD_29
   1101                      }
   1102                      else
   1103                      {
   1104                        zgDefaultChannelList=(uint32)((uint32)1<<channel);
   \                     ??SampleApp_SerialCMD_28:
   \   00045B   75..01       MOV     ?V0,#0x1
   \   00045E   75..00       MOV     ?V1,#0x0
   \   000461   75..00       MOV     ?V3,#0x0
   \   000464   85..82       MOV     DPL,?XSP + 0
   \   000467   85..83       MOV     DPH,?XSP + 1
   \   00046A   E0           MOVX    A,@DPTR
   \   00046B   78..         MOV     R0,#?V0
   \   00046D   12....       LCALL   ?L_SHL
   \   000470   90....       MOV     DPTR,#zgDefaultChannelList
   \   000473   78..         MOV     R0,#?V0
   \   000475   12....       LCALL   ?L_MOV_TO_X
   1105                      }
   1106                      printf("<CH,0x%02X,0x%08lX>\r\n", channel, zgDefaultChannelList);
   \                     ??SampleApp_SerialCMD_29:
   \   000478                ; Setup parameters for call to function printf
   \   000478   90....       MOV     DPTR,#zgDefaultChannelList
   \   00047B   12....       LCALL   ?PUSH_XSTACK8_X_FOUR
   \   00047E   7404         MOV     A,#0x4
   \   000480   12....       LCALL   ?XSTACK_DISP0_8
   \   000483   12....       LCALL   ?PUSH_XSTACK8_X_TWO
   \   000486   7A..         MOV     R2,#`?<Constant "<CH,0x%02X,0x%08lX>\\r\\n">` & 0xff
   \   000488   7B..         MOV     R3,#(`?<Constant "<CH,0x%02X,0x%08lX>\\r\\n">` >> 8) & 0xff
   \   00048A   12....       LCALL   ??printf?relay       ; Banked call to: printf
   \   00048D   7406         MOV     A,#0x6
   \   00048F   12....       LCALL   ?DEALLOC_XSTACK8
   1107                      //保存到NV
   1108                      if(nvItemInit(ZCD_NV_CHANLIST,sizeof(zgDefaultChannelList), &zgDefaultChannelList,TRUE) != ZSUCCESS)
   \   000492                ; Setup parameters for call to function nvItemInit
   \   000492   75....       MOV     ?V0,#zgDefaultChannelList & 0xff
   \   000495   75....       MOV     ?V1,#(zgDefaultChannelList >> 8) & 0xff
   \   000498   78..         MOV     R0,#?V0
   \   00049A   12....       LCALL   ?PUSH_XSTACK_I_TWO
   \   00049D   7901         MOV     R1,#0x1
   \   00049F   7C04         MOV     R4,#0x4
   \   0004A1   7D00         MOV     R5,#0x0
   \   0004A3   7A84         MOV     R2,#-0x7c
   \   0004A5   7B00         MOV     R3,#0x0
   \   0004A7   12....       LCALL   ??nvItemInit?relay   ; Banked call to: nvItemInit
   \   0004AA   7402         MOV     A,#0x2
   \   0004AC   12....       LCALL   ?DEALLOC_XSTACK8
   \   0004AF   E9           MOV     A,R1
   \   0004B0   7006         JNZ     ??SampleApp_SerialCMD_23
   1109                      {
   1110                        printf("<DCH,F>\r\n");
   1111                      }
   1112                      else
   1113                      {
   1114                        printf("<DCH,T>\r\n");
   \   0004B2                ; Setup parameters for call to function printf
   \   0004B2   7A..         MOV     R2,#`?<Constant "<DCH,T>\\r\\n">` & 0xff
   \   0004B4   7B..         MOV     R3,#(`?<Constant "<DCH,T>\\r\\n">` >> 8) & 0xff
   \   0004B6   8004         SJMP    ??SampleApp_SerialCMD_17
   1115                      }
   1116                    }
   1117                  }
   1118                  else
   1119                  {
   1120                    printf("<DCH,F>\r\n");
   \                     ??SampleApp_SerialCMD_23:
   \   0004B8                ; Setup parameters for call to function printf
   \   0004B8   7A..         MOV     R2,#`?<Constant "<DCH,F>\\r\\n">` & 0xff
   \   0004BA   7B..         MOV     R3,#(`?<Constant "<DCH,F>\\r\\n">` >> 8) & 0xff
   \                     ??SampleApp_SerialCMD_17:
   \   0004BC   12....       LCALL   ??printf?relay       ; Banked call to: printf
   \   0004BF   805A         SJMP    ??SampleApp_SerialCMD_2
   1121                  }
   1122                }
   1123                
   1124                //调试信息开关（DG）
   1125                else if(osal_memcmp(str,"#DG",3)) 
   \                     ??SampleApp_SerialCMD_18:
   \   0004C1                ; Setup parameters for call to function osal_memcmp
   \   0004C1   75....       MOV     ?V0,#`?<Constant "#DG">` & 0xff
   \   0004C4   75....       MOV     ?V1,#(`?<Constant "#DG">` >> 8) & 0xff
   \   0004C7   75..00       MOV     ?V2,#0x0
   \   0004CA   78..         MOV     R0,#?V0
   \   0004CC   12....       LCALL   ?PUSH_XSTACK_I_THREE
   \   0004CF   7C03         MOV     R4,#0x3
   \   0004D1   7D00         MOV     R5,#0x0
   \   0004D3   8E82         MOV     DPL,R6
   \   0004D5   8F83         MOV     DPH,R7
   \   0004D7   A982         MOV     R1,DPL
   \   0004D9   AA83         MOV     R2,DPH
   \   0004DB   7B00         MOV     R3,#0x0
   \   0004DD   12....       LCALL   ??osal_memcmp?relay  ; Banked call to: osal_memcmp
   \   0004E0   7403         MOV     A,#0x3
   \   0004E2   12....       LCALL   ?DEALLOC_XSTACK8
   \   0004E5   E9           MOV     A,R1
   \   0004E6   6028         JZ      ??SampleApp_SerialCMD_0
   1126                {
   1127                  int temp;
   1128                  
   1129                  temp = atoi(str+4);
                                     ^
Warning[Pe167]: argument of type "unsigned char *" is incompatible with
          parameter of type "char const *"
   \   0004E8                ; Setup parameters for call to function atoi
   \   0004E8   12....       LCALL   ??Subroutine10_0 & 0xFFFF
   \                     ??CrossCallReturnLabel_36:
   \   0004EB   12....       LCALL   ??atoi?relay         ; Banked call to: atoi
   \   0004EE   8A..         MOV     ?V0,R2
   \   0004F0   8B..         MOV     ?V1,R3
   \   0004F2   A8..         MOV     R0,?V0
   \   0004F4   A9..         MOV     R1,?V1
   1130                  if(temp==0||temp==1)
   \   0004F6   E8           MOV     A,R0
   \   0004F7   49           ORL     A,R1
   \   0004F8   6006         JZ      ??SampleApp_SerialCMD_30
   \   0004FA   7401         MOV     A,#0x1
   \   0004FC   68           XRL     A,R0
   \   0004FD   49           ORL     A,R1
   \   0004FE   7010         JNZ     ??SampleApp_SerialCMD_0
   1131                  {
   1132                    debug = temp;
   \                     ??SampleApp_SerialCMD_30:
   \   000500   90....       MOV     DPTR,#debug
   \   000503   E8           MOV     A,R0
   \   000504   F0           MOVX    @DPTR,A
   \   000505   A3           INC     DPTR
   \   000506   E9           MOV     A,R1
   \   000507   F0           MOVX    @DPTR,A
   1133                    ReturnTorF( 1, 1 ); //正确
   \   000508                ; Setup parameters for call to function ReturnTorF
   \                     ??SampleApp_SerialCMD_12:
   \   000508   7C01         MOV     R4,#0x1
   \   00050A   7D00         MOV     R5,#0x0
   \   00050C   7A01         MOV     R2,#0x1
   \   00050E   8006         SJMP    ??SampleApp_SerialCMD_31
   1134                  }
   1135                  else
   1136                  {
   1137                    ReturnTorF( 0, 1 ); //错误
   1138                  }
   1139                  
   1140                }
   1141                else
   1142                {
   1143                  ReturnTorF( 0, 1 ); //错误
   1144                }
   1145             }
   1146             else
   1147             {
   1148                ReturnTorF( 0, 1 ); //错误
   \                     ??SampleApp_SerialCMD_0:
   \   000510                ; Setup parameters for call to function ReturnTorF
   \   000510   7C01         MOV     R4,#0x1
   \   000512   7D00         MOV     R5,#0x0
   \   000514   7A00         MOV     R2,#0x0
   \                     ??SampleApp_SerialCMD_31:
   \   000516   7B00         MOV     R3,#0x0
   \   000518   12....       LCALL   ??ReturnTorF?relay   ; Banked call to: ReturnTorF
   1149             }
   1150             
   1151          }
   \                     ??SampleApp_SerialCMD_2:
   \   00051B   7402         MOV     A,#0x2
   \   00051D   12....       LCALL   ?DEALLOC_XSTACK8
   \   000520   7F07         MOV     R7,#0x7
   \   000522   02....       LJMP    ?BANKED_LEAVE_XDATA

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   \                     ?Subroutine7:
   \   000000   7C..         MOV     R4,#`?<Constant "%x">` & 0xff
   \   000002   7D..         MOV     R5,#(`?<Constant "%x">` >> 8) & 0xff
   \   000004                REQUIRE ??Subroutine10_0
   \   000004                ; // Fall through to label ??Subroutine10_0

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   \                     ??Subroutine10_0:
   \   000000   EE           MOV     A,R6
   \   000001   2404         ADD     A,#0x4
   \   000003   FA           MOV     R2,A
   \   000004   E4           CLR     A
   \   000005   3F           ADDC    A,R7
   \   000006   FB           MOV     R3,A
   \   000007   22           RET

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   \                     ?Subroutine2:
   \   000000   85..82       MOV     DPL,?XSP + 0
   \   000003   85..83       MOV     DPH,?XSP + 1
   \   000006   E4           CLR     A
   \   000007   F0           MOVX    @DPTR,A
   \   000008   A3           INC     DPTR
   \   000009   F0           MOVX    @DPTR,A
   \   00000A                ; Setup parameters for call to function sscanf
   \   00000A                ; Setup parameters for call to function sscanf
   \   00000A                ; Setup parameters for call to function sscanf
   \   00000A   A8..         MOV     R0,?XSP + 0
   \   00000C   A9..         MOV     R1,?XSP + 1
   \   00000E   88..         MOV     ?V0,R0
   \   000010   89..         MOV     ?V1,R1
   \   000012   78..         MOV     R0,#?V0
   \   000014   22           RET
   1152          
   1153          /*********************************************************************
   1154           * @fn      sendData
   1155           *
   1156           * @brief   串口向采集器发送数据
   1157           *
   1158           * @param   none
   1159           *
   1160           * @return  none
   1161           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   1162          void SendDataToCollector(char *ptr, int len)
   \                     SendDataToCollector:
   1163          {
   \   000000   C082         PUSH    DPL
   \   000002   C083         PUSH    DPH
   \   000004                ; Saved register size: 2
   \   000004                ; Auto size: 0
   1164              HalUARTWrite(0,ptr,len);
                                    ^
Warning[Pe167]: argument of type "char *" is incompatible with parameter of
          type "unsigned char *"
   \   000004                ; Setup parameters for call to function HalUARTWrite
   \   000004   7900         MOV     R1,#0x0
   \   000006   12....       LCALL   ??HalUARTWrite?relay ; Banked call to: HalUARTWrite
   1165          }
   \   000009                REQUIRE ?Subroutine1
   \   000009                ; // Fall through to label ?Subroutine1

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   \                     ?Subroutine1:
   \   000000   D083         POP     DPH
   \   000002   D082         POP     DPL
   \   000004   02....       LJMP    ?BRET
   1166          
   1167          /*********************************************************************
   1168           * @fn      Order_Parse
   1169           *
   1170           * @brief   协调器或串口指令解析,flag：1 指示终端设备，0 指示协调器设备
   1171           *
   1172           * @param   none
   1173           *
   1174           * @return  none
   1175           */
   1176          //void Order_Parse(char *str, int len, int flag)
   1177          //{
   1178          //   uint8 i;
   1179          //   int numbers;
   1180          //     /* 上位机指令解析 */
   1181          //   if(*(str+len-1)== '\n')
   1182          //   {
   1183          //#if defined (ZDO_COORDINATOR) || defined (RTR_NWK) //协调器
   1184          //      if(osal_memcmp(str,"#DM",3)) //主采读取数据
   1185          //      {
   1186          //        /* 主采读取数据 */
   1187          //        numbers = sprintf(data_coor, "BG,ID001,%04d,%03d,%04d,ID002,%04d,%03d,%04d,ID003,%04d,%03d,%04d,ED\r\n",coordi[0].temperature,
   1188          //                          coordi[0].humidity,coordi[0].photosyn,coordi[1].temperature,coordi[1].humidity,coordi[1].photosyn,
   1189          //                          coordi[2].temperature,coordi[2].humidity,coordi[2].photosyn); //数据填充
   1190          //        
   1191          //        SendDataToCollector(data_coor, COOR_DATA_LEN); //数据发往主采集器
   1192          //        
   1193          //        osal_memset(coordi, 0, sizeof(dataType_t)*3); //发送后数据清零
   1194          //      }
   1195          //      else if(osal_memcmp(str,"#RS",3))
   1196          //      {
   1197          //        /* 复位 */
   1198          //        ReturnTorF(1, 1); //正确
   1199          //        SampleApp_SendPeriodicMessage(str, len); //转发复位指令给终端传感器
   1200          //        
   1201          //        rs_flag = 1;//置位停止喂狗标志
   1202          //        
   1203          //      }
   1204          //      else if(osal_memcmp(str,"#GH",3)) //协调器使用GH指令给传感器设置光合表系数
   1205          //      {
   1206          //        SampleApp_SendPeriodicMessage(str, len);
   1207          //      }
   1208          //#else //终端节点
   1209          //      if(osal_memcmp(str,"#ID",3))
   1210          //      {
   1211          //        if(len == 5) //读取设备ID
   1212          //        {          
   1213          //          printf("<ID,%03u>\r\n", sensor_id);
   1214          //        }
   1215          //        else //设置设备ID
   1216          //        {
   1217          //          int temp_id;
   1218          //          
   1219          //          sscanf(str+4, "%d", &temp_id);                           
   1220          //          if(temp_id>=1 && temp_id<=3)
   1221          //          {
   1222          //            sensor_id = temp_id;
   1223          //            
   1224          //            /* 设备ID存入flash */
   1225          //            sprintf(dev_id, "%03u", sensor_id);
   1226          //            
   1227          //            if(SUCCESS == osal_nv_write(DEVICE_ID, 0, DEVICE_ID_LEN, dev_id))
   1228          //              HalUARTWrite(0,"T\n",2 ); //存入成功
   1229          //            else
   1230          //              HalUARTWrite(0,"F\n",2 ); //存入失败
   1231          //          }
   1232          //          else
   1233          //          {
   1234          //            HalUARTWrite(0,"F\n",2 ); //错误
   1235          //          }
   1236          //        }
   1237          //      }
   1238          //      else if(osal_memcmp(str,"#GH",3))
   1239          //      {
   1240          //        if(len == 5) //读取光合表系数
   1241          //        {
   1242          //          printf("<GH,%05.2f>\r\n", gh_factor);
   1243          //        }
   1244          //        else //设置光合表系数
   1245          //        {
   1246          //          float temp_gh;
   1247          //          
   1248          //          sscanf(str+4, "%f", &temp_gh);
   1249          //          if(temp_gh>=1.0)
   1250          //          {
   1251          //            gh_factor = temp_gh;
   1252          //            
   1253          //            /* 光合表系数存入flash */
   1254          //            sprintf(dev_gh, "%5.2f", gh_factor);
   1255          //            
   1256          //            if(SUCCESS == osal_nv_write(DEVICE_GH, 0, DEVICE_GH_LEN, dev_gh))
   1257          //              HalUARTWrite(0,"T\n",2 ); //存入成功
   1258          //            else
   1259          //              HalUARTWrite(0,"F\n",2 ); //存入失败
   1260          //          }
   1261          //          else
   1262          //          {
   1263          //            HalUARTWrite(0,"F\n",2 ); //错误
   1264          //          }
   1265          //        }
   1266          //      }
   1267          //      else if(osal_memcmp(str,"#RS",3))//复位
   1268          //      {
   1269          //        /* 复位 */     
   1270          //        rs_flag = 1;//置位停止喂狗标志     
   1271          //      }
   1272          //#endif
   1273          //      else if(osal_memcmp(str,"#DG",3)) //调试信息开关
   1274          //      {
   1275          //        int temp;
   1276          //        
   1277          //        temp = atoi(str+4);
   1278          //        if(temp==0||temp==1)
   1279          //        {
   1280          //          debug = temp;
   1281          //          HalUARTWrite(0,"T\n",2 ); //正确
   1282          //        }
   1283          //        else
   1284          //        {
   1285          //          HalUARTWrite(0,"F\n",2 ); //错误
   1286          //        }
   1287          //        
   1288          //      }
   1289          //      else
   1290          //      {
   1291          //        HalUARTWrite(0,"F\n",2 ); //错误
   1292          //      }
   1293          //   }
   1294          //   else
   1295          //   {
   1296          //      HalUARTWrite(0,"F\n",2 ); //错误
   1297          //   }
   1298          //}
   1299          
   1300          /*********************************************************************
   1301           * @fn      ReturnTorF
   1302           *
   1303           * @brief   指令返回'T'或'F'，参数a:1 回复'T',0 回复'F'；参数b:1 发往串口，0 发往协调器
   1304           *
   1305           * @param   none
   1306           *
   1307           * @return  none
   1308           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   1309          void ReturnTorF(int a, int b)
   \                     ReturnTorF:
   1310          {
   \   000000   C082         PUSH    DPL
   \   000002   C083         PUSH    DPH
   \   000004                ; Saved register size: 2
   \   000004                ; Auto size: 0
   1311            if(a)
   \   000004   EA           MOV     A,R2
   \   000005   4B           ORL     A,R3
   \   000006   6014         JZ      ??ReturnTorF_0
   1312            {
   1313              if(b)
   \   000008   EC           MOV     A,R4
   \   000009   4D           ORL     A,R5
   \   00000A   6006         JZ      ??ReturnTorF_1
   1314              {
   1315                printf("T\r\n");
   \   00000C                ; Setup parameters for call to function printf
   \   00000C   7A..         MOV     R2,#`?<Constant "T\\r\\n">` & 0xff
   \   00000E   7B..         MOV     R3,#(`?<Constant "T\\r\\n">` >> 8) & 0xff
   \   000010   8012         SJMP    ??ReturnTorF_2
   1316              }
   1317              else
   1318              {
   1319                SampleApp_SendPointToPointMessage("T\r\n", sizeof("T\r\n"));
   \                     ??ReturnTorF_1:
   \   000012                ; Setup parameters for call to function SampleApp_SendPointToPointMessage
   \   000012   7C04         MOV     R4,#0x4
   \   000014   7D00         MOV     R5,#0x0
   \   000016   7A..         MOV     R2,#`?<Constant "T\\r\\n">` & 0xff
   \   000018   7B..         MOV     R3,#(`?<Constant "T\\r\\n">` >> 8) & 0xff
   \   00001A   8015         SJMP    ??ReturnTorF_3
   1320              }
   1321            }
   1322            else
   1323            {
   1324              if(b)
   \                     ??ReturnTorF_0:
   \   00001C   EC           MOV     A,R4
   \   00001D   4D           ORL     A,R5
   \   00001E   6009         JZ      ??ReturnTorF_4
   1325              {
   1326                printf("F\r\n");
   \   000020                ; Setup parameters for call to function printf
   \   000020   7A..         MOV     R2,#`?<Constant "F\\r\\n">` & 0xff
   \   000022   7B..         MOV     R3,#(`?<Constant "F\\r\\n">` >> 8) & 0xff
   \                     ??ReturnTorF_2:
   \   000024   12....       LCALL   ??printf?relay       ; Banked call to: printf
   \   000027   800B         SJMP    ??ReturnTorF_5
   1327              }
   1328              else
   1329              {
   1330                SampleApp_SendPointToPointMessage("F\r\n", sizeof("F\r\n"));
   \                     ??ReturnTorF_4:
   \   000029                ; Setup parameters for call to function SampleApp_SendPointToPointMessage
   \   000029   7C04         MOV     R4,#0x4
   \   00002B   7D00         MOV     R5,#0x0
   \   00002D   7A..         MOV     R2,#`?<Constant "F\\r\\n">` & 0xff
   \   00002F   7B..         MOV     R3,#(`?<Constant "F\\r\\n">` >> 8) & 0xff
   \                     ??ReturnTorF_3:
   \   000031   12....       LCALL   ??SampleApp_SendPointToPointMessage?relay; Banked call to: SampleApp_SendPointToPointMessage
   1331              }
   1332              
   1333            }
   1334            
   1335          }
   \                     ??ReturnTorF_5:
   \   000034   80..         SJMP    ?Subroutine1

   \                                 In  segment XDATA_ID, align 1, keep-with-next
   \                     `?<Initializer for data_coor>`:
   \   000000   42472C49     DB 42H, 47H, 2CH, 49H, 44H, 30H, 30H, 31H
   \            44303031
   \   000008   2C2D3630     DB 2CH, 2DH, 36H, 30H, 30H, 2CH, 30H, 39H
   \            302C3039
   \   000010   392C3132     DB 39H, 2CH, 31H, 32H, 33H, 34H, 2CH, 49H
   \            33342C49
   \   000018   44303032     DB 44H, 30H, 30H, 32H, 2CH, 2DH, 36H, 30H
   \            2C2D3630
   \   000020   302C3039     DB 30H, 2CH, 30H, 39H, 39H, 2CH, 31H, 32H
   \            392C3132
   \   000028   33342C49     DB 33H, 34H, 2CH, 49H, 44H, 30H, 30H, 33H
   \            44303033
   \   000030   2C2D3630     DB 2CH, 2DH, 36H, 30H, 30H, 2CH, 30H, 39H
   \            302C3039
   \   000038   392C3132     DB 39H, 2CH, 31H, 32H, 33H, 34H, 2CH, 45H
   \            33342C45
   \   000040   440D0A00     DB 44H, 0DH, 0AH, 0
   \   000044   00000000     DB 0, 0, 0, 0, 0, 0, 0, 0
   \            00000000
   \   00004C   00000000     DB 0, 0, 0, 0, 0, 0, 0, 0
   \            00000000
   \   000054   00000000     DB 0, 0, 0, 0, 0, 0, 0, 0
   \            00000000
   \   00005C   00000000     DB 0, 0, 0, 0, 0, 0, 0, 0
   \            00000000
   \   000064   00000000     DB 0, 0, 0, 0, 0, 0, 0, 0
   \            00000000
   \   00006C   00000000     DB 0, 0, 0, 0, 0, 0, 0, 0
   \            00000000
   \   000074   00000000     DB 0, 0, 0, 0, 0, 0, 0, 0
   \            00000000
   \   00007C   00000000     DB 0, 0, 0, 0

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??SampleApp_Init?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    SampleApp_Init

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??SampleApp_ProcessEvent?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    SampleApp_ProcessEvent

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??SampleApp_MessageMSGCB?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    SampleApp_MessageMSGCB

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??SampleApp_SendPeriodicMessage?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    SampleApp_SendPeriodicMessage

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??SampleApp_SendPointToPointMessage?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    SampleApp_SendPointToPointMessage

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??SampleApp_SerialCMD?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    SampleApp_SerialCMD

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??SendDataToCollector?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    SendDataToCollector

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??ReturnTorF?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    ReturnTorF

   \                                 In  segment XDATA_ROM_C, align 1
   \                     `?<Constant "System init!\\n">`:
   \   000000   53797374     DB "System init!\012"
   \            656D2069
   \            6E697421
   \            0A00    

   \                                 In  segment XDATA_ROM_C, align 1
   \                     `?<Constant "Group 1">`:
   \   000000   47726F75     DB "Group 1"
   \            70203100

   \                                 In  segment XDATA_ROM_C, align 1
   \                     `?<Constant "SampleApp">`:
   \   000000   53616D70     DB "SampleApp"
   \            6C654170
   \            7000    

   \                                 In  segment XDATA_ROM_C, align 1
   \                     `?<Constant "NET SUCCESS!\\r\\n">`:
   \   000000   4E455420     DB "NET SUCCESS!\015\012"
   \            53554343
   \            45535321
   \            0D0A00  

   \                                 In  segment XDATA_ROM_C, align 1
   \                     `?<Constant "Router:0x%04X\\r\\nParent...">`:
   \   000000   526F7574     DB 52H, 6FH, 75H, 74H, 65H, 72H, 3AH, 30H
   \            65723A30
   \   000008   78253034     DB 78H, 25H, 30H, 34H, 58H, 0DH, 0AH, 50H
   \            580D0A50
   \   000010   6172656E     DB 61H, 72H, 65H, 6EH, 74H, 3AH, 30H, 78H
   \            743A3078
   \   000018   25303458     DB 25H, 30H, 34H, 58H, 0DH, 0AH, 43H, 68H
   \            0D0A4368
   \   000020   616E6E65     DB 61H, 6EH, 6EH, 65H, 6CH, 3AH, 25H, 64H
   \            6C3A2564
   \   000028   0D0A5061     DB 0DH, 0AH, 50H, 61H, 6EH, 49H, 44H, 3AH
   \            6E49443A
   \   000030   30782530     DB 30H, 78H, 25H, 30H, 34H, 58H, 0DH, 0AH
   \            34580D0A
   \   000038   00           DB 0

   \                                 In  segment XDATA_ROM_C, align 1
   \                     `?<Constant "IEEE:%02X%02X%02X%02X...">`:
   \   000000   49454545     DB "IEEE:%02X%02X%02X%02X%02X%02X%02X%02X\015\012"
   \            3A253032
   \            58253032
   \            58253032
   \            58253032
   \            58253032
   \            58253032
   \            58253032
   \            58253032
   \            580D0A00

   \                                 In  segment XDATA_ROM_C, align 1
   \                     `?<Constant "Parent IEEE:%02X%02X%...">`:
   \   000000   50617265     DB "Parent IEEE:%02X%02X%02X%02X%02X%02X%02X%02X\015\012"
   \            6E742049
   \            4545453A
   \            25303258
   \            25303258
   \            25303258
   \            25303258
   \            25303258
   \            25303258
   \            25303258
   \            25303258
   \            0D0A00  

   \                                 In  segment XDATA_ROM_C, align 1
   \                     `?<Constant "EndDevice:0x%04X\\r\\nPar...">`:
   \   000000   456E6444     DB 45H, 6EH, 64H, 44H, 65H, 76H, 69H, 63H
   \            65766963
   \   000008   653A3078     DB 65H, 3AH, 30H, 78H, 25H, 30H, 34H, 58H
   \            25303458
   \   000010   0D0A5061     DB 0DH, 0AH, 50H, 61H, 72H, 65H, 6EH, 74H
   \            72656E74
   \   000018   3A307825     DB 3AH, 30H, 78H, 25H, 30H, 34H, 58H, 0DH
   \            3034580D
   \   000020   0A436861     DB 0AH, 43H, 68H, 61H, 6EH, 6EH, 65H, 6CH
   \            6E6E656C
   \   000028   3A25640D     DB 3AH, 25H, 64H, 0DH, 0AH, 50H, 61H, 6EH
   \            0A50616E
   \   000030   49443A30     DB 49H, 44H, 3AH, 30H, 78H, 25H, 30H, 34H
   \            78253034
   \   000038   580D0A00     DB 58H, 0DH, 0AH, 0

   \                                 In  segment XDATA_ROM_C, align 1
   \                     `?<Constant "Coordinator:0x%04X\\r\\nC...">`:
   \   000000   436F6F72     DB "Coordinator:0x%04X\015\012Channel:%d\015\012PanID:0x%04X\015\012"
   \            64696E61
   \            746F723A
   \            30782530
   \            34580D0A
   \            4368616E
   \            6E656C3A
   \            25640D0A
   \            50616E49
   \            443A3078
   \            25303458
   \            0D0A00  

   \                                 In  segment XDATA_ROM_C, align 1
   \                     `?<Constant "NO NET\\r\\n">`:
   \   000000   4E4F204E     DB "NO NET\015\012"
   \            45540D0A
   \            00      

   \                                 In  segment XDATA_ROM_C, align 1
   \                     `?<Constant "#DM">`:
   \   000000   23444D00     DB "#DM"

   \                                 In  segment XDATA_ROM_C, align 1
   \                     `?<Constant "BG,ID001,%04d,%03d,%0...">`:
   \   000000   42472C49     DB 42H, 47H, 2CH, 49H, 44H, 30H, 30H, 31H
   \            44303031
   \   000008   2C253034     DB 2CH, 25H, 30H, 34H, 64H, 2CH, 25H, 30H
   \            642C2530
   \   000010   33642C25     DB 33H, 64H, 2CH, 25H, 30H, 34H, 64H, 2CH
   \            3034642C
   \   000018   49443030     DB 49H, 44H, 30H, 30H, 32H, 2CH, 25H, 30H
   \            322C2530
   \   000020   34642C25     DB 34H, 64H, 2CH, 25H, 30H, 33H, 64H, 2CH
   \            3033642C
   \   000028   25303464     DB 25H, 30H, 34H, 64H, 2CH, 49H, 44H, 30H
   \            2C494430
   \   000030   30332C25     DB 30H, 33H, 2CH, 25H, 30H, 34H, 64H, 2CH
   \            3034642C
   \   000038   25303364     DB 25H, 30H, 33H, 64H, 2CH, 25H, 30H, 34H
   \            2C253034
   \   000040   642C4544     DB 64H, 2CH, 45H, 44H, 0DH, 0AH, 0
   \            0D0A00  

   \                                 In  segment XDATA_ROM_C, align 1
   \                     `?<Constant "#RS">`:
   \   000000   23525300     DB "#RS"

   \                                 In  segment XDATA_ROM_C, align 1
   \                     `?<Constant "clear\\r\\n">`:
   \   000000   636C6561     DB "clear\015\012"
   \            720D0A00

   \                                 In  segment XDATA_ROM_C, align 1
   \                     `?<Constant "#GH">`:
   \   000000   23474800     DB "#GH"

   \                                 In  segment XDATA_ROM_C, align 1
   \                     `?<Constant "#PD">`:
   \   000000   23504400     DB "#PD"

   \                                 In  segment XDATA_ROM_C, align 1
   \                     `?<Constant "<PD,0x%04X>\\r\\n">`:
   \   000000   3C50442C     DB "<PD,0x%04X>\015\012"
   \            30782530
   \            34583E0D
   \            0A00    

   \                                 In  segment XDATA_ROM_C, align 1
   \                     `?<Constant "%x">`:
   \   000000   257800       DB "%x"

   \                                 In  segment XDATA_ROM_C, align 1
   \                     `?<Constant "#CH">`:
   \   000000   23434800     DB "#CH"

   \                                 In  segment XDATA_ROM_C, align 1
   \                     `?<Constant "<CH,0x%02X>\\r\\n">`:
   \   000000   3C43482C     DB "<CH,0x%02X>\015\012"
   \            30782530
   \            32583E0D
   \            0A00    

   \                                 In  segment XDATA_ROM_C, align 1
   \                     `?<Constant "#SA">`:
   \   000000   23534100     DB "#SA"

   \                                 In  segment XDATA_ROM_C, align 1
   \                     `?<Constant "<SA,0x%04X>\\r\\n">`:
   \   000000   3C53412C     DB "<SA,0x%04X>\015\012"
   \            30782530
   \            34583E0D
   \            0A00    

   \                                 In  segment XDATA_ROM_C, align 1
   \                     `?<Constant "#DPD">`:
   \   000000   23445044     DB "#DPD"
   \            00      

   \                                 In  segment XDATA_ROM_C, align 1
   \                     `?<Constant "<DPD,0x%04X>\\r\\n">`:
   \   000000   3C445044     DB "<DPD,0x%04X>\015\012"
   \            2C307825
   \            3034583E
   \            0D0A00  

   \                                 In  segment XDATA_ROM_C, align 1
   \                     `?<Constant "<DPD,F>\\r\\n">`:
   \   000000   3C445044     DB "<DPD,F>\015\012"
   \            2C463E0D
   \            0A00    

   \                                 In  segment XDATA_ROM_C, align 1
   \                     `?<Constant "<DPD,T>\\r\\n">`:
   \   000000   3C445044     DB "<DPD,T>\015\012"
   \            2C543E0D
   \            0A00    

   \                                 In  segment XDATA_ROM_C, align 1
   \                     `?<Constant "#DCH">`:
   \   000000   23444348     DB "#DCH"
   \            00      

   \                                 In  segment XDATA_ROM_C, align 1
   \                     `?<Constant "<DCH,ALL>\\r\\n">`:
   \   000000   3C444348     DB "<DCH,ALL>\015\012"
   \            2C414C4C
   \            3E0D0A00

   \                                 In  segment XDATA_ROM_C, align 1
   \                     `?<Constant "<DCH,0x%02X>\\r\\n">`:
   \   000000   3C444348     DB "<DCH,0x%02X>\015\012"
   \            2C307825
   \            3032583E
   \            0D0A00  

   \                                 In  segment XDATA_ROM_C, align 1
   \                     `?<Constant "ALL">`:
   \   000000   414C4C00     DB "ALL"

   \                                 In  segment XDATA_ROM_C, align 1
   \                     `?<Constant "all">`:
   \   000000   616C6C00     DB "all"

   \                                 In  segment XDATA_ROM_C, align 1
   \                     `?<Constant "<CH,F>\\r\\n">`:
   \   000000   3C43482C     DB "<CH,F>\015\012"
   \            463E0D0A
   \            00      

   \                                 In  segment XDATA_ROM_C, align 1
   \                     `?<Constant "<CH,0x%02X,0x%08lX>\\r\\n">`:
   \   000000   3C43482C     DB "<CH,0x%02X,0x%08lX>\015\012"
   \            30782530
   \            32582C30
   \            78253038
   \            6C583E0D
   \            0A00    

   \                                 In  segment XDATA_ROM_C, align 1
   \                     `?<Constant "<DCH,F>\\r\\n">`:
   \   000000   3C444348     DB "<DCH,F>\015\012"
   \            2C463E0D
   \            0A00    

   \                                 In  segment XDATA_ROM_C, align 1
   \                     `?<Constant "<DCH,T>\\r\\n">`:
   \   000000   3C444348     DB "<DCH,T>\015\012"
   \            2C543E0D
   \            0A00    

   \                                 In  segment XDATA_ROM_C, align 1
   \                     `?<Constant "#DG">`:
   \   000000   23444700     DB "#DG"

   \                                 In  segment XDATA_ROM_C, align 1
   \                     `?<Constant "T\\r\\n">`:
   \   000000   540D0A00     DB "T\015\012"

   \                                 In  segment XDATA_ROM_C, align 1
   \                     `?<Constant "F\\r\\n">`:
   \   000000   460D0A00     DB "F\015\012"

   \                                 In  segment XDATA_ROM_C, align 1
   \                     __Constant_7fff800:
   \   000000   00F8FF07     DD 134215680
   1336          
   1337          /*********************************************************************
   1338          *********************************************************************/

   Maximum stack usage in bytes:

   ISTACK XSTACK Function
   ------ ------ --------
      2     17   ReturnTorF
        2      0   -> SampleApp_SendPointToPointMessage
        2      0   -> printf
      0     14   SampleApp_Init
        0     11   -> ADC_Init
        0     11   -> HalLcdWriteString
        0     11   -> MT_UartInit
        0     11   -> MT_UartRegisterTaskID
        0     11   -> RegisterForKeys
        0     11   -> WDT_Init
        0     11   -> ZDOInitDevice
        0     11   -> afRegister
        0     11   -> aps_AddGroup
        0     14   -> osal_memcpy
        0     11   -> osal_memset
        0     11   -> osal_start_reload_timer
        0     11   -> printf
        0     11   -> readCoordinatorJumper
      0     22   SampleApp_MessageMSGCB
        0     10   -> HalUARTWrite
        0     10   -> atoi
      0     28   SampleApp_ProcessEvent
        0     12   -> SampleApp_MessageMSGCB
        0     12   -> SampleApp_SerialCMD
        0     12   -> WDT_Feed
        0     12   -> osal_msg_deallocate
        0     12   -> osal_msg_receive
        0     12   -> printf
        0     18   -> printf
        0     20   -> printf
        0     28   -> printf
      0     36   SampleApp_SendPeriodicMessage
        0     19   -> AF_DataRequest
      0     19   SampleApp_SendPointToPointMessage
        0     19   -> AF_DataRequest
      0     47   SampleApp_SerialCMD
        0     17   -> NLME_UpdateNV
        0     17   -> ReturnTorF
        0     17   -> SampleApp_SendPeriodicMessage
        0     17   -> SendDataToCollector
        0     17   -> atoi
        0     19   -> nvItemInit
        0     20   -> osal_memcmp
        0     17   -> osal_memset
        0     17   -> printf
        0     19   -> printf
        0     23   -> printf
        0     35   -> sprintf
        0     19   -> sscanf
        0     17   -> zgWriteStartupOptions
      2     17   SendDataToCollector
        2      0   -> HalUARTWrite


   Segment part sizes:

   Bytes  Function/Label
   -----  --------------
       4  ?<Constant "#CH">
       5  ?<Constant "#DCH">
       4  ?<Constant "#DG">
       4  ?<Constant "#DM">
       5  ?<Constant "#DPD">
       4  ?<Constant "#GH">
       4  ?<Constant "#PD">
       4  ?<Constant "#RS">
       4  ?<Constant "#SA">
       3  ?<Constant "%x">
      22  ?<Constant "<CH,0x%02X,0x%08lX>\r\n">
      14  ?<Constant "<CH,0x%02X>\r\n">
       9  ?<Constant "<CH,F>\r\n">
      15  ?<Constant "<DCH,0x%02X>\r\n">
      12  ?<Constant "<DCH,ALL>\r\n">
      10  ?<Constant "<DCH,F>\r\n">
      10  ?<Constant "<DCH,T>\r\n">
      15  ?<Constant "<DPD,0x%04X>\r\n">
      10  ?<Constant "<DPD,F>\r\n">
      10  ?<Constant "<DPD,T>\r\n">
      14  ?<Constant "<PD,0x%04X>\r\n">
      14  ?<Constant "<SA,0x%04X>\r\n">
       4  ?<Constant "ALL">
      71  ?<Constant "BG,ID001,%04d,%03d,%0...">
      47  ?<Constant "Coordinator:0x%04X\r\nC...">
      60  ?<Constant "EndDevice:0x%04X\r\nPar...">
       4  ?<Constant "F\r\n">
       8  ?<Constant "Group 1">
      40  ?<Constant "IEEE:%02X%02X%02X%02X...">
      15  ?<Constant "NET SUCCESS!\r\n">
       9  ?<Constant "NO NET\r\n">
      47  ?<Constant "Parent IEEE:%02X%02X%...">
      57  ?<Constant "Router:0x%04X\r\nParent...">
      10  ?<Constant "SampleApp">
      14  ?<Constant "System init!\n">
       4  ?<Constant "T\r\n">
       4  ?<Constant "all">
       8  ?<Constant "clear\r\n">
     128  ?<Initializer for data_coor>
       6  ??ReturnTorF?relay
       6  ??SampleApp_Init?relay
       6  ??SampleApp_MessageMSGCB?relay
       6  ??SampleApp_ProcessEvent?relay
       6  ??SampleApp_SendPeriodicMessage?relay
       6  ??SampleApp_SendPointToPointMessage?relay
       6  ??SampleApp_SerialCMD?relay
       6  ??SendDataToCollector?relay
       8  ??Subroutine10_0
       6  ??Subroutine8_0
       5  ??Subroutine9_0
       8  ?Subroutine0
       7  ?Subroutine1
      21  ?Subroutine2
       3  ?Subroutine3
      12  ?Subroutine4
      15  ?Subroutine5
       8  ?Subroutine6
       4  ?Subroutine7
      12  Point_To_Point_DstAddr
      54  ReturnTorF
       1  SampleAppFlashCounter
       1  SampleAppPeriodicCounter
       8  SampleApp_ClusterList
      12  SampleApp_Flash_DstAddr
      18  SampleApp_Group
     263  SampleApp_Init
     212  SampleApp_MessageMSGCB
       1  SampleApp_NwkState
      12  SampleApp_Periodic_DstAddr
     536  SampleApp_ProcessEvent
      63  SampleApp_SendPeriodicMessage
      65  SampleApp_SendPointToPointMessage
    1317  SampleApp_SerialCMD
      12  SampleApp_SimpleDesc
       1  SampleApp_TaskID
       1  SampleApp_TransID
       6  SampleApp_epDesc
       9  SendDataToCollector
       4  __Constant_7fff800
       4  cal_t0
      18  coordi
     128  data_coor
       2  debug
      10  dev_gh
      10  dev_id
      10  dev_wddt
       4  gh_factor
       2  rs_flag
       2  sensor_id

 
 2 616 bytes in segment BANKED_CODE
    48 bytes in segment BANK_RELAYS
   128 bytes in segment XDATA_I
   128 bytes in segment XDATA_ID
   622 bytes in segment XDATA_ROM_C
   127 bytes in segment XDATA_Z
 
 2 792 bytes of CODE  memory
   618 bytes of CONST memory (+ 4 bytes shared)
   255 bytes of XDATA memory

Errors: none
Warnings: 21
